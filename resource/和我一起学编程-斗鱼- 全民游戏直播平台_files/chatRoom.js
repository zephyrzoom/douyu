var clicknickuser;var clickuid;var click_chatid=null;var sum_height=383;var min_y=325;var max_y=580;var touristuid=0;var sendtime=0;var interval=3;var saiduserlist=new Array();var regintervalobj;var sofa_info_arr=new Array();var buglecursurposition=0;var cursurposition=0;var buglewidth=0;var buglesumwidth=0;var room_user_num=0;var send_interval_time=1;var intervaltime=1;var in_input=false;var follow_stat=0;var sign_stat=0;var roomgrouplist=new Array();var user_black_list=new Array();var maxcontent=50;var cq_tit_obj;var barrage_color=0;var barrage_color_list=["#FF0000","#0000FF","#008000","#FF7F00","#8A2BE2","#FF69B4"];if($SYS.uid){if($SYS.uid==$ROOM.owner_uid){roomgrouplist[$SYS.uid]=[];roomgrouplist[$SYS.uid]["roomgroup"]=5}else{roomgrouplist[$SYS.uid]=[];roomgrouplist[$SYS.uid]["roomgroup"]=1}$ROOM.room_url+="?fromuid="+$SYS.uid}if(!$SYS.uid&&!get_cookie("regpoint")&&($("#guide_login").length>0)){setCookie("regpoint",1,21600);setTimeout('if(!$("#small_nav").is(":visible")){$("#guide_login,#back").show();}',10000)}if($("#tscroll").length>0){var cqtit,_=Function;with(o=document.getElementById("tscroll")){innerHTML+=innerHTML;onmouseover=_("cqtit=1");onmouseout=_("cqtit=0")}(F=_("if(#%28||!cqtit)#++,#%=o.scrollHeight>>1;setTimeout(F,#%28?10:2500);".replace(/#/g,"o.scrollTop")))()}function rm_follow(){if(!$SYS.uid){open_login();return false}$.dialog({content:"您是否取消关注？",icon:"question",okVal:"确定",ok:function(){$.get("/room/follow/cancel/"+$ROOM.room_id,function(d){if(d=="ok"){$.dialog.tips_black("已取消关注",2);$(".follow_btn").hide();$(".follow_btn").eq(0).show();follow_stat=0;var c=$("#followtit").length?parseInt($("#followtit").html().replace(/,/g,"")):0;$("#followtit").html(number_format(c-1));if($("#leftfollow").length>0){$("#leftfollow").html(number_format(parseInt($("#leftfollow").html().replace(/,/g,""))-1))}}else{if(d!=""){$.dialog.alert(d)}else{$.dialog.alert("发生错误，请重试")}}})},cancelVal:"取消",lock:true,cancel:function(){}})}function isopen_chat(){if(!$SYS.uid){open_login();return false}$.dialog.confirm("完成手机验证后才能进行弹幕发送",function(){window.location.href="/member/cp#phone"})}function isshow_chat(e){var c=Sttdecode(e);var g={};for(var d in c){g[c[d].name]=c[d].value}if(typeof g.npv!="undefined"){if(g.npv==1){var f="/member/cp#phone";if($("body").data("page")=="qqapp"){f="/joint/member_cp#phone"}$("#sms_chandiv").html('<textarea  class="cs_unbound" id="chart_content" maxlength="50" placeholder="" tabindex="1" readonly></textarea><p class="bindp" style="position:absolute; top:20px; left:22px; color:#919191; letter-spacing:2px;"><a style="color:#ff921a; text-decoration:underline;" href="'+f+'">验证手机号</a>即可拥有发弹幕的特权！</p><div class="b_btn" onclick="bindphone_submit();"><a tabindex="2" href="javascript:void(0);" onclick="bindphone_submit();">发<br>送</a></div>');$("#snow_sms_chandiv").html('<input class="cs_txt" id="chart_content" maxlength="20" name="chart_content" placeholder="" value="" tabindex="1" readonly="readonly" type="text" /><p class="bindp" style="position:absolute; top:10px; left:22px; color:#919191; letter-spacing:2px;"><a style="color:#ff921a; text-decoration:underline;" href="'+f+'">验证手机号</a>即可拥有发弹幕的特权！</p> <a class="cs_btn" tabindex="2" href="javascript:void(0);" onclick="bindphone_submit();">发送</a> ');$("#nba_sms_chandiv").html('<input type="text" readonly="readonly" class="cs_textarea" id="chart_content" maxlength="50" placeholder="" tabindex="1" /><p class="bindp" style="position:absolute; top:20px; left:22px; color:#919191; letter-spacing:2px;"><a style="color:#ff921a; text-decoration:underline;" href="'+f+'">验证手机号</a>即可拥有发弹幕的特权！</p><div class="b_btn" onclick="bindphone_submit();"><a tabindex="2" href="javascript:void(0);" onclick="bindphone_submit();">发<br>送</a></div>')}}}function follow_room(){if(!$SYS.uid){open_login();return false}if($SYS.uid==$ROOM.owner_uid){$.dialog.tips_black("不能关注自己的房间",2);return false}$.get("/room/follow/add/"+$ROOM.room_id,function(d){if(d=="ok"){$(".follow_btn").hide();$(".follow_btn").eq(1).show();follow_stat=1;var e;$.dialog({icon:"succeed",content:"成功加入您的关注列表",lock:true,init:function(){var h=this,f=3;var g=function(){h.title(f+"秒后关闭");!f&&h.close();f--};e=setInterval(g,1000);g()},close:function(){clearInterval(e)}}).show();var c=$("#followtit").length?parseInt($("#followtit").html().replace(/,/g,"")):0;$("#followtit").html(number_format(c+1));if($("#leftfollow").length>0){$("#leftfollow").html(number_format(parseInt($("#leftfollow").html().replace(/,/g,""))+1))}}else{if(d!=""){$.dialog.alert(d)}else{$.dialog.alert("主播不能关注自己的房间")}}})}var surplus_time_obj;var is_barrage=true;function display_barrage(){if(is_barrage){$("#barrage_info").html("<span>开启弹幕</span>");is_barrage=false}else{$("#barrage_info").html("<span>关闭弹幕</span>");is_barrage=true}thisMovie("WebRoom").js_barrage(is_barrage)}function get_time_str(d){var f=Math.floor(d/3600);var c=Math.floor((d-f*3600)/60);var e=d-f*3600-c*60;return f+"小时"+c+"分"+e+"秒"}function common_call(params){var param_arr=Sttdecode(params);var obj={};for(var i in param_arr){obj[param_arr[i].name]=param_arr[i].value}if(typeof obj.func!="undefined"&&typeof obj.param!="undefinded"){var callback=obj.func;eval(callback)(obj.param)}}function super_close_room_tips(e){var c=Sttdecode(e);var f={};for(var d in c){f[c[d].name]=c[d].value}if(typeof f.notify!="undefined"&&typeof f.rid!="undefined"){if(f.notify>0&&f.rid==$ROOM.room_id){var g="本次直播已经结束";if(f.code==2){g="该主播涉嫌违规播放，本次直播已被管理员关闭"}$.dialog.alert(g)}if(parseInt(f.code)==1){if(($SYS.uid!=$ROOM.owner_uid)&&$SYS.groupid<5&&(!$SYS.uid||(roomgrouplist[$SYS.uid]["roomgroup"]<4))&&((f.endtime-$ROOM.show_time)>900)){more_video.room_show();if($("#live_player").hasClass("alls")){page_scrn()}thisMovie("WebRoom").js_exitFullScreen()}}}}var more_time_obj;var more_video={room_show:function(){$.ajax({type:"GET",url:"/swf_api/get_more_video",dataType:"json",data:{cate_id:$ROOM.cate_id},success:function(c){if(typeof(c.room_list_info)!="undefined"){var d="";a=1;$.each(c.room_list_info,function(e,f){if(($ROOM.room_id!=f.room_id)&&(a<=8)){d+='<li><a target="_blank" href="/'+e+'"><div class="pic"><img src="'+f.room_src+'"></div><h3>'+f.name+'</h3><p><span class="icon2 fl">';d+=f.online+'</span><span class="icon1 fl">'+f.nickname+"</span></p></a></li>";a++}});$("#more_ul").html(d);$("#more_video").show();more_video.time_show(parseInt(Math.random()*(25-10+1)+10))}}})},time_show:function(c){if(c>0){$("#more_time").html(c);c--;more_time_obj=setTimeout('more_video.time_show("'+c+'")',1000)}else{$("#more_time_p").html("");clearTimeout(more_time_obj);window.location.href=$("#more_ul").find("a").eq(0).attr("href")}}};function close_room_tips(){if($SYS.uid==$ROOM.owner_uid){var c="您的房间已被关闭，详情请联系客服人员。"}else{var c="您观看的房间已被关闭，请选择其他直播进行观看哦！"}$.dialog({title:"房间关闭提示",icon:"warning",content:'<p style="color:red">'+c+"</p>",init:function(){var f=this,d=8;var e=function(){f.title(d+"秒后关闭");!d&&f.close();d--};timer=setInterval(e,1000);e()},ok:function(){this.close()},lock:true,close:function(){clearInterval(timer);window.location.href=$SYS.uid==$ROOM.owner_uid?"/room/my":"/"}})}function call_resize(d,c){try{var f=d+"|"+c;thisMovie("WebRoom").js_sendsize(f)}catch(g){setTimeout("call_resize("+d+", "+c+")",5000)}}function set_live_height(){var g=$(window).height()||$(document).height();var j=$(window).width()||$(document).width();if($("#live_player").hasClass("alls")){if($("#left_col").length){$("#main_col").height(g)}$("#live_player .swf_container").height(g);call_resize(j,g);return false}if($("#left_col").length){var i=function(){var n=$("#left_col");var p=$("#right_col");var h=j-(n.is(":hidden")?0:n.width())-(p.is(":hidden")?0:p.width());if(ie6){n.css({height:g});p.css({height:g})}}();var m=$("#live_player").width();var f=9/16*m+42;$("#chatdiv").height(g);var k=($("#broadcast_div").length>0)&&!$("#broadcast_div").is(":hidden")?g-$("#broadcast_div").height()-20-117:g-117;k=$("#cq_fans").length>0&&!$("#cq_fans").is(":hidden")?k-112:k;$("#chat_lines").height(k);var c=0;$("div.js_live_height").each(function(){if($(this).hasClass("host")){c+=$(this).outerHeight(false)}else{c+=$(this).outerHeight(true)}});var l=$(".room_mes").outerHeight(true)+$("#header").height()+f;var e=$("#header").height()+f;if(l>g&&e<=g){setTimeout(function(){$("#main_col").scrollTop($(".room_mes").outerHeight(true)-4)},100)}if(e>g){setTimeout(function(){$("#main_col").scrollTop($(".room_mes").outerHeight(true)-4)},100);f=g-$("#header").height()-8}$("#live_player").height(f);$(".swf_container").height(f);$("#main_col").height(g);call_resize(m,f);set_room_title_width()}else{$("#live_player .swf_container").height($("#live_player").height());call_resize($("#live_player").width(),$("#live_player").height());var d=$(".chat_cont").height()-10;d=$("#cq_fans").length>0&&!$("#cq_fans").is(":hidden")?d-112:d;$("#chat_lines").height(d)}}function set_room_title_width(){var d=$("#room_title").width();$("#room_title > h1").width("auto");var c=$("#room_title > h1").width();if(d-c<110){$("#room_title > h1").width(d-110)}}function set_window_width(){if($("#live_player").hasClass("alls")){return false}var c=$(window).width()||$(document).width();var d=$("#left_col");if(d.length===0){return false}var e=$("#right_col");var g=$("#large_nav");var f=$("#small_nav");var h=$("#main_col");if(c<=1300&&g.is(":visible")){g.hide();f.show();d.css("width","49px");h.css("margin-left","49px");$("#left_close").addClass("left_open")}if(c>1300&&get_cookie("left_menu")==="0"){h.css("margin-left","240px");d.css("width","240px");f.hide();g.show();$("#left_close").removeClass("left_open");setTimeout(left_scroll.update,500)}if(c<=1100&&e.is(":visible")){e.hide();h.css("margin-right",0);$("#right_close").addClass("right_open")}if(c>1100&&get_cookie("right_menu")!="1"){h.css("margin-right","325px");e.show();$("#right_close").removeClass("right_open")}set_ad_width()}function super_close_room(){$.dialog({id:"setcata",title:"关闭房间",content:document.getElementById("close_frm"),ok:function(){var d=$("#reason").val();var c=+$("#close_time").val();if(c<=0){$.dialog.tips_black("请填写正确的关闭时间");return false}if(d.length<1){$.dialog.tips_black("请输入关闭原因！");return false}$.dialog({content:"您确定此房间的要关闭直播吗",icon:"question",okVal:"确定",ok:function(){loading.show();$.ajax({type:"POST",url:"/room/my_admin/super_close_room",data:$("#close_frm").serialize(),dataType:"json",success:function(e){loading.close();if(e.ret>0){$.dialog.tips_black(e.msg)}else{window.location.href="/"+$ROOM.room_id+"?_r="+Math.random(1)}}})},cancelVal:"取消",cancel:function(){}})},cancelVal:"关闭",cancel:true,lock:true})}function set_age_limit(){$.dialog({id:"setagelimit",title:"用户发言设置",content:document.getElementById("js_speak_set"),ok:function(){var d=$("#s_agelimit").val();d=$.trim(d);$("#s_agelimit").val(d);var c=/^\d*$/;if(!c.test(d)){$.dialog.tips_black("最低注册时间填写有误");return false}var e=$("#speak_cd").val();e=$.trim(e);$("#speak_cd").val(e);if(!c.test(e)){$.dialog.tips_black("CD发言倍数填写有误");return false}e=parseInt(e,10);if(e<1||e>100){$.dialog.tips_black("CD发言倍数只能在1~100之间");return false}loading.show();$.ajax({type:"POST",url:"/room/my_admin/speak_set",data:$("#js_speak_set").serialize(),dataType:"json",success:function(f){loading.close();if(f.error==0){$.dialog.tips_black("设置成功，请等待几分钟的更新")}else{$.dialog.alert(f.msg)}}})},cancelVal:"关闭",cancel:true,lock:true})}function ios_push(d,c){if(c){$.dialog.confirm("确定将该房间推送到IOS手机上么?",function(){loading.show();$.ajax({type:"POST",url:"/room/my_admin/ios_push",data:{id:d,status:"PUSH"},dataType:"json",success:function(e){loading.close();if(e.error==0){$.dialog.tips_black("已成功推送到IOS上，请等待更新！")}else{$.dialog.alert("推送错误:<span style='color: red'>"+e.msg+"</span>")}}})})}else{$.dialog.confirm("确定<span style='color: red'>取消</span>IOS的推送么?",function(){loading.show();$.ajax({type:"POST",url:"/room/my_admin/ios_push",data:{id:d,status:"CANCEL"},dataType:"json",success:function(e){loading.close();if(e.error==0){$.dialog.tips_black("取消推送IOS成功，请等待更新！")}else{$.dialog.alert("操作失败:<span style='color: red'>"+e.msg+"</span>")}}})})}return false}function white_list(d,c){if(c){$.dialog.confirm("确定将该房间添加到开播列表么?",function(){loading.show();$.ajax({type:"POST",url:"/room/my_admin/white_list",data:{id:d,status:"PUSH"},dataType:"json",success:function(e){loading.close();if(e.error==0){$.dialog.tips_black("已成功添加到开播列表，请等待更新！")}else{$.dialog.alert("推送错误:<span style='color: red'>"+e.msg+"</span>")}}})})}else{$.dialog.confirm("确定<span style='color: red'>取消</span>开播推荐么?",function(){loading.show();$.ajax({type:"POST",url:"/room/my_admin/white_list",data:{id:d,status:"CANCEL"},dataType:"json",success:function(e){loading.close();if(e.error==0){$.dialog.tips_black("取消开播推荐成功，请等待更新！")}else{$.dialog.alert("操作失败:<span style='color: red'>"+e.msg+"</span>")}}})})}return false}function js_set_newbie(d,c){if(c){$.dialog.confirm("确定将该房间设为新秀么?",function(){loading.show();$.ajax({type:"POST",url:"/room/my_admin/set_newbie",data:{id:d,status:"PUSH"},dataType:"json",success:function(e){loading.close();if(e.error==0){$.dialog.tips_black("已成功将该房间设为新秀，请等待更新！")}else{$.dialog.alert("设置错误:<span style='color: red'>"+e.msg+"</span>")}}})})}else{$.dialog.confirm("确定<span style='color: red'>取消</span>新秀么?",function(){loading.show();$.ajax({type:"POST",url:"/room/my_admin/set_newbie",data:{id:d,status:"CANCEL"},dataType:"json",success:function(e){loading.close();if(e.error==0){$.dialog.tips_black("该房间取消新秀成功，请等待更新！")}else{$.dialog.alert("操作失败:<span style='color: red'>"+e.msg+"</span>")}}})})}return false}function js_set_launch_remind(c,d){$.dialog.confirm("确认"+(d?"打开":"取消")+"开播提醒",function(){loading.show();$.ajax({type:"POST",url:"/room/my_admin/remind_switch",data:{id:c},dataType:"json",success:function(e){loading.close();if(e.error==0){$.dialog.tips_black("操作成功，请等待更新！")}else{$.dialog.alert("设置错误:<span style='color: red'>"+e.msg+"</span>")}}})})}function follow_change(c){$(".follow_btn").hide();if(c==1){$(".follow_btn").eq(1).show();follow_stat=1}else{$(".follow_btn").eq(0).show();follow_stat=0}}function thisMovie(c){if(navigator.appName.indexOf("Microsoft")!=-1){return window[c]}else{return document[c]}}function sendlog(){var d="";var e="";var c=check_user_login();if(c){d=c.wl_username;e=c.wl_auth}var f="type@=loginreq/username@="+d+"/password@="+e+"/roomid@="+$ROOM.room_id+"/";thisMovie("WebRoom").js_userlogin(f)}function delCookie(d){var c=new Date();c.setTime(c.getTime()-10000);document.cookie=$SYS.cookie_pre+d+"=a; expires="+c.toGMTString()}function server_error(e){var c=Sttdecode(e);var d=c[1]["value"];var f="";switch(d){case"51":f="数据传输出错!";break;case"52":f="服务器关闭!";close_room_tips();break;case"53":f="服务器繁忙!";break;case"54":f="服务器维护中!";break;case"55":f="用户满员!";break;case"56":f="IP封禁!";$.post("/member/logout/ajax",function(g){try{thisMovie("WebRoom").js_userlogout()}catch(h){}},"json");$.dialog.tips_black("您已被管理员做封号处理.您当前IP也被禁止登陆12小时!");setTimeout('window.location.href = "/"',3000);break;return;case"57":f="帐号封禁!";$.dialog.tips_black("帐号被封禁！");setTimeout('window.location.href = "/"',3000);break;return;case"58":f="用户名密码错误!";break;case"59":$.dialog.tips_black("您的账号已在其他地方登录，请注意账号安全！!");break;case"60":$.dialog.tips_black("聊天信息包含敏感词语！");break;case"252":$.dialog.tips_black("网络异常");break;case"203":$.dialog.tips_black("您的登录已过期请重新登录！");setTimeout('if($("#js_login_dialog").is(":hidden")){user_dialog.open_login()}',3500);break;case"287":$.dialog({content:"服务器正在维护中，请重新刷新页面！",icon:"warning",okVal:"刷新",ok:function(){window.location.reload()},cancelVal:"确定",cancel:function(){}});break;default:return}}function tourist_login(){var c=check_user_login();if(!c){setTimeout("user_dialog.open_reg()",25000);regintervalobj=setInterval("check_tourist()",120000)}}function check_tourist(){var c=check_user_login();if(!c){user_dialog.open_reg()}else{clearInterval(regintervalobj)}}var cq_stat=0;function return_tourist(e){var d=Sttdecode(e);touristuid=d[0]["value"];sign_stat=d[2]["value"];cq_stat=parseInt(getsttdata(d,"cur_lev"));if(!cq_stat&&($SYS.uid!=$ROOM.owner_uid)){if(!get_cookie("cqtit")){cq_tit_obj=setTimeout('$("#cq_tit").show();thisMovie("WebRoom").js_exitFullScreen();setCookie("cqtit",1,28800);',600000)}}var c=check_user_login();$("#follow_sign").remove();if(c){setCookie("groupid",d[5]["value"],2592000);$SYS.groupid=d[5]["value"];task_obj.get_task_stat();$("#signbut,#signbut2").hide();if(d[2]["value"]==0){$("#follow_sign,#signbut").show()}else{$("#follow_sign,#signbut2").show()}if(parseInt(d[3]["value"])>=2&&parseInt(d[2]["value"])==0){$("#follow_sign,#signbut2,#signbut").hide()}if($SYS.uid==$ROOM.owner_uid){$("#follow_sign").hide()}}else{task_obj.show_tasktip();$("#follow_sign").hide()}roomgrouplist[d[0]["value"]]=new Array();roomgrouplist[d[0]["value"]]["roomgroup"]=d[4]["value"];if($("body").data("cq")){thisMovie("WebRoom").js_rewardList()}}function get_show_status(d){var c=0;$.ajax({type:"POST",url:"tool/show_status/"+d,data:"",success:function(e){c=e;if($ROOM.show_status==0&&c==1){$.dialog({content:"直播开始了！",icon:"information",okVal:"刷新页面",ok:function(){window.location.reload()},cancelVal:"确定",cancel:function(){}})}}})}var ad_obj={get_device_id:function(d){if(!d){return false}var c=Sttdecode(d);$.ajax({type:"GET",url:"/live_specific/get_room_show_info"+window.location.search,dataType:"json",data:{device:c[0]["value"],time:c[1]["value"],adv:c[2]["value"],roomid:$ROOM.room_id},success:function(e){if(e.hasOwnProperty("adlist")&&e.adlist){show_obj.ad_show(e.adlist)}show_obj.room_info_show(e.room_info)}})}};var show_obj={ad_show:function(c){if(!module_switch.promotion){return false}$("#promotion_ul").html("");if(c){var d="";num=1001;$.each(c,function(e,f){d+='<li><a target="_blank" ';if(f.promotion.link){d+='href="specific/promotion_click?adid='+f.key+"&num="+num+"&roomid="+$ROOM.room_id+'"'}d+=' ><img src="'+f.promotion.url+'" width="300" height="280"></a></li>';num++});$("#promotion_ul").html(d);set_ad_width()}},room_info_show:function(d){if(typeof(d.room_fans)!="undefined"){$("#followtit").html(d.room_fans)}if(typeof(d.owner_weight)!="undefined"){$("#weighttit").html(d.owner_weight)}if(typeof(d.user_balance)!="undefined"){$("#ywtit").html("鱼丸 "+number_format(d.user_balance.silver)).attr("title","做任务可获得鱼丸").data("value",d.user_balance.silver);$("#yctit").html("鱼翅 "+number_format(d.user_balance.gold/100)).data("value",d.user_balance.gold)}if(typeof(d.follow_num)!="undefined"){$("#leftfollow").html(d.follow_num)}$("#folowload").remove();if(typeof(d.follow)!="undefined"){follow_change(d.follow);$("#folowload").remove();$("#folowshow").show()}if(typeof(d.lv_info)!="undefined"){$("#leftlever").html("<img src="+$SYS.res_url+"douyu/images/classimg/"+d.lv_info.current.pic+" />");var c=parseInt(d.user_score/100);if(typeof(d.lv_info.next)!="undefined"){$("#leftlever").attr("title","下一级："+d.lv_info.next.name);var f=Math.ceil((d.lv_info.next.score-d.user_score)/100);var e='<div class="arrow"></div>还差<i>'+f+"</i>个战斗力可以升为<i>["+d.lv_info.next.name+"]</i><br />";$("#leverline").css("width",parseInt((d.user_score-d.lv_info.current.score)/(d.lv_info.next.score-d.lv_info.current.score)*100)+"%");$("#leverscore").html(c+"/"+parseInt(d.lv_info.next.score/100))}else{var e='<div class="arrow"></div>哇靠，已经是<i>【最强王者】</i>了~^~';$("#leverline").css("width","100%");$("#leverscore").html(c+"/"+parseInt(d.user_score/100))}$("#bartit").html(e)}if(typeof(d.unixtime)!="undefined"){check_time_delay(d.unixtime);if($("body").data("view")){if($ROOM.show_status==1&&$SYS.uid==$ROOM.owner_uid){$("#rtmp_url").val(d.rtmp_send.rtmp_url);$("#rtmp_val").val(d.rtmp_send.rtmp_val);$("#livecode_but").show();if($("#livecode_but").length==0){live_code_show()}}else{$("#livecode_but").remove()}}else{if($ROOM.show_status==1&&$SYS.uid==$ROOM.owner_uid&&!$("body").data("view")){if(load_live_info){load_live_info.close()}else{return false}if($("#live_code").length<=0){return false}$("#rtmp_url").val(d.rtmp_send.rtmp_url);$("#rtmp_val").val(d.rtmp_send.rtmp_val);$.dialog({content:document.getElementById("live_code"),id:"live_tips",title:"直播信息",cancelVal:"关闭",cancel:true,lock:true,padding:"10px 25px",init:function(){$("#copy_rtmp_url").zclip({path:$SYS.res_url+"images/ZeroClipboard.swf",copy:$("#rtmp_url").val(),afterCopy:function(){$.dialog.tips_black("已成功复制rtmp地址",1.5)}});$("#copy_rtmp_val").zclip({path:$SYS.res_url+"images/ZeroClipboard.swf",copy:$("#rtmp_val").val(),afterCopy:function(){$.dialog.tips_black("已成功复制直播码",1.5)}})}})}}}}};var box_time_obj;var box_jump_obj;var box_obj={show_time:function(e){$("#box_div").show();var c=Sttdecode(e);var d=c[0]["value"];$("#box_show").data("leve",d);$("#box_show").data("stat",c[1]["value"]==0?1:0);$("#box").removeClass();clearInterval(box_jump_obj);if(parseInt(d)>5){$("#box").addClass("box_img close6");$("#get_fc,#get_fc2").hide();$("#get_time").html("完成");return false}if(c[1]["value"]==0){$("#box").addClass("box_img get"+d);$("#get_time").html("领取")}else{$("#box").addClass("box_img close"+d);box_obj.time_show(parseInt(c[1]["value"])+60)}},time_show:function(e){var c=Math.floor(e/60);var d=e%60;c=c<10?"0"+c:c;d=d<10?"0"+d:d;$("#get_time").html(c+":"+d);clearInterval(box_time_obj);box_time_obj=setInterval("box_obj.time_run()",1000)},time_run:function(){var f=$("#get_time").html();if((f==undefined)||f.length==0){return false}var h=f.split(":");var c=parseInt(h[0]);var g=parseInt(h[1]);var i=c*60+g;if(i>1){i--;var d=Math.floor(i/60);var e=i%60;d=d<10?"0"+d:d;e=e<10?"0"+e:e;$("#get_time").html(d+":"+e)}else{$("#get_time").html("领取");clearInterval(box_time_obj);$("#box").removeClass();$("#box").addClass("box_img get"+$("#box_show").data("leve"));$("#box_show").data("stat",1)}},tit_show:function(d){var c=document.createElement("span");$(c).html(d);$(c).addClass("get_rem");$("#get_rem").append(c);$(c).css({bottom:"20px"});$(c).animate({bottom:"100px"},1000,function(){$(c).fadeOut("slow",function(){$(c).remove()})})},send_receive:function(){if($("#task_ca").val().length!=4){$.dialog.tips_black("请填写正确的验证码!",1);return false}$("#lyzmbut").addClass("bnn2");$("#lyzmbut").prop("disabled",true);$.ajax({type:"POST",url:"/member/cp/get_box_reward",data:{leve:$("#box_show").data("leve"),task_ca:$("#task_ca").val(),room_id:$ROOM.room_id},dataType:"json",success:function(d){if(d.ret==2){$.dialog({content:"当前ip输入验证码时错误次数过多，请等待一天后在重新尝试！",icon:"warning",okVal:"确定",ok:function(){}})}else{if(d.ret==1){$.dialog.tips_black("验证码输入错误",1);user_form.update_vcode("task_captcha");$("#task_ca").val("")}else{if(d.result==0){clearInterval(box_time_obj);$("#lyzm,#back").hide();$("#taskid").val("");$("#ywtit").data("value",parseInt($("#ywtit").data("value"))+parseInt(d.gift_count));$("#ywtit").html("鱼丸 "+number_format($("#ywtit").data("value")));if(d.leve<=5){box_obj.tit_show("恭喜你获得"+d.gift_count+"个鱼丸！")}var g=(parseInt(d.leve)+1);var f=[{name:"lev",value:g}];var e=0;switch(g){case 1:e=300;break;case 2:e=600;break;case 3:e=1800;break;case 4:e=2700;break;case 5:e=3000;break}f.push({name:"lack_time",value:e});box_obj.show_time(Sttencode(f))}else{var h="";var c="/member";switch(d.result){case"216":h="需要绑定手机和邮箱才能领取鱼丸！";c="/member";break;case"218":h="需要绑定手机才能领取鱼丸!";c="/member#phone";break;case"219":h="需要绑定邮箱才能领取鱼丸!";c="/member#mod_email";break;case"270":h="请稍后再试!";break;default:h="鱼丸领取失败！"}if(d.result=="216"||d.result=="218"||d.result=="219"){$.dialog({content:h,title:"提示",icon:"warning",cancelVal:"以后再说",okVal:"立即绑定",lock:true,ok:function(){window.location.href=c},cancel:function(){$("#task_ca").val("");$("#lyzm,#back").hide();$("#taskid").val("")}})}else{$.dialog.alert(h);user_form.update_vcode("task_captcha");$("#task_ca").val("")}}}}}})}};var showintervalobj;var cq_obj={clear_show:function(){$.dialog({id:"cqclear",content:"\u9ad8\u5cf0\u65f6\u6bb5\u0028\u0032\u0030\u003a\u0030\u0030\u002d\u0032\u0033\u003a\u0030\u0030\u0029\u002c\u4ec5\u652f\u6301\u8d2d\u4e70\u916c\u52e4\u6708\u7968\u7684\u7528\u6237\u89c2\u770b\u8d85\u6e05\u76f4\u64ad\uff01",width:"400px",button:[{name:$("#cqbut").length>0?"\u6210\u4e3a\u916c\u52e4\u4f1a\u5458":"\u83b7\u53d6\u9c7c\u7fc5",callback:function(){if($("#cqbut").length>0){$("#cqbut").click()}else{window.open("/web_game/welcome/18")}}},]})},buy_msg:function(f){var c=Sttdecode(f);var e=get_leve_info(parseInt(c[8]["value"]));var g=return_img("classtype",e.current.pic);g+=' <a href="#" class="nick" rel='+c[0]["value"]+" >"+c[2]["value"]+"</a> 赠送了";switch(c[9]["value"]){case"1":g+="初级酬勤";break;case"2":g+="中级酬勤";break;case"3":g+="高级酬勤";break;case"4":g+="超级酬勤";break}g+="<img  src="+$SYS.res_url+"douyu/images/cq_0"+c[9]["value"]+".gif?  />";g+='成为了本房间<span><img  src="'+$SYS.res_url+"douyu/images/cq_no0"+c[9]["value"]+".png?"+$SYS.res_ver+'"  /></span>会员';var d=add_ttlist("chat_line_list");$(d).html(g);cq_obj.get_super_obj(c[2]["value"],c[9]["value"]);if($("#cscroll").data("stat")){scrdown("chat_lines")}},get_super_obj:function(c,e){var d=document.createElement("div");$(d).addClass("cq_give");$(d).addClass("cq_g0"+e);var f='<p class="g_tt">'+c+'</p><p class="g_num">赠送给主播<em>1</em>个</p>';$(d).html(f);gift_obj.super_show(d)},buy:function(e){var c=0;var d=0;var g=null;switch(e){case 1:d=$("#cqdiv").data("change")?1000:1000;c=60;break;case 2:d=$("#cqdiv").data("change")?2000:5000;c=80;break;case 3:d=$("#cqdiv").data("change")?4000:10000;c=120;break;case 4:d=$("#cqdiv").data("change")?18000:70000;c=130;break}var f="<p>你已获得：<br/><span>"+d+'</span>鱼丸 + <span>30</span>天<img src="'+$SYS.res_url+"douyu/images/cq_no0"+e+".png?"+$SYS.res_ver+'">会员头衔；</p><p>主播直播满<span>'+c+"</span>小时可获得酬勤奖励。</p>";$.ajax({type:"POST",url:"/member/cq/buy",data:{owner_uid:$ROOM.owner_uid,lv:e},dataType:"json",success:function(h){switch(h.ret.result){case"0":$("#cqdiv").hide();$("#gmtit").html("获得"+$ROOM.owner_name+"房间VIP"+e+"会员头衔30天");$("#gmts").html(f);$("#buys").show();$("#yctit").html("鱼翅 "+number_format(h.ret.balance/100));$("#ywtit").data("value",parseInt($("#ywtit").data("value"))+d);$("#ywtit").html("鱼丸 "+number_format($("#ywtit").data("value")));if(g){clearTimeout(g)}g=setTimeout('$("#buys").hide()',30000);clearTimeout(cq_tit_obj);break;case"283":$("#pay_msg").show();break;default:$.dialog.tips_black("酬勤赠送失败",2)}}});$("#js_cq_goon_send").off("click").on("click",function(){if(g){clearTimeout(g)}$("#buys").hide();$("#jumpic .cqgm").eq(e-1).trigger("click")});$("#js_cq_ok").off("click").on("click",function(){if(g){clearTimeout(g)}$("#buys").hide()})},rank:function(f){var d=Sttdecode(f);var e=getsttdata(d,"list");if(!e){return false}e=e.replace(new RegExp("@A","g"),"@");list_array=e.split("//");var g="";var c=1;$.each(list_array,function(j,m){if(m==""||c>10){return false}var k=Sttdecode(m);var h=getsttdata(k,"nickname");var l=getsttdata(k,"strength");var i=get_leve_info(l);if(j==0){g+='<li class="first">'}else{g+="<li>"}if(j>=3){g+='<i class="icon r4">'+(j+1)+"</i>"}else{g+='<img class="hg" src="'+$SYS.res_url+"douyu/images/cq_hg0"+(j+1)+'.png">'}g+='<span class="l_pic">'+return_img("classtype",i.current.pic)+"</span>";g+='<a href="javascript:;">'+h+"</a></li>";c++});$("#cq_rank").html(g);$("#cq_fans,#cqf_but,#cq_rank_div").show();$("#details").hide();$("#details_div").removeClass("activ");$("#cqf_but").addClass("activ");$("#details_div,#cqf_but").width(161);if($("body").data("view")){if($("#cq_fans").length>0&&!$("#cq_fans").is(":hidden")){$(".chat_cls").css("top","205px");$(".gift_rolling").css("top","196px")}}else{if($("#cq_fans").length>0&&!$("#cq_fans").is(":hidden")){$(".chat_cls").css("top","120px");$(".gift_rolling").css("top","111px")}}set_live_height();if($("#header").length>0){set_right_height()}}};var black_obj={black_show:function(){var c=!$SYS.uid?touristuid:$SYS.uid;if((roomgrouplist[c]["roomgroup"]<4&&$SYS.groupid!=5)||c==clickuid){return false}$.dialog({title:"用户屏蔽",content:document.getElementById("blackshow"),id:"black900l",ok:function(){return black_obj.black_user_send("black_send")},cancelVal:"关闭",cancel:true});$("#blacktime").focus();return false},black_user_send:function(g){var d=check_user_login();if(!d){user_dialog.open_reg();return false}var f=0;if(g=="black_send"){f=$("#blacktime").val();if(isNaN(f)||f<=0){$.dialog.tips_black("请重新输入!");return false}var e=$('input[name="range"]:checked').val();var c=$('input[name="blacktype"]:checked').val();if(e==2){c=c==2?4:1;if(f>99){$.dialog.tips_black("封禁时长不能超过99小时!");return false}}else{if(f>720){$.dialog.tips_black("封禁时长不能超过720小时!");return false}}f=f*3600}else{}var h=[{name:"type",value:"blackreq"},{name:"userid",value:clickuid},{name:"blacktype",value:c},{name:"limittime",value:f}];var i=Sttencode(h);$("#blacktime").val("99");thisMovie("WebRoom").js_blackuser(i)},black_myblacklis_add:function(){if(jQuery.inArray(parseInt(clickuid),user_black_list)>-1||user_black_list.length>=10){return false}$("#user_black").html("取消屏蔽");$("#user_black").attr("rel",1);user_black_list.push(parseInt(clickuid));black_obj.black_myblacklis_send(user_black_list.join("|"))},black_myblacklis_del:function(){if(jQuery.inArray(parseInt(clickuid),user_black_list)==-1){return false}$("#user_black").html("屏蔽该用户");$("#user_black").attr("rel",0);var c=jQuery.inArray(parseInt(clickuid),user_black_list);user_black_list.splice(c,1);black_obj.black_myblacklis_send(user_black_list.join("|"))},black_myblacklis_send:function(c){thisMovie("WebRoom").js_myblacklist(c)},black_onekeyblack:function(){var c=!$SYS.uid?touristuid:$SYS.uid;if($SYS.groupid!=5||c==clickuid){$.dialog.alert("没有相应权限!");return false}var d=clicknickuser;if(d.charAt(d.length-1)==":"){d=d.substring(0,d.length-1)}$("#onekeyblackshow .userinfo").html("封禁用户:<span style='color:blue'>"+d+"</span>");$.dialog({title:"用户一键封号",content:document.getElementById("onekeyblackshow"),id:"oneKeyblack00l",ok:function(){var f=$("#onekeyblackshow input:radio:checked[name='reason_choice']").next().val();f=$.trim(f);if(f==""){$.dialog.alert("原因未填写");return false}if(f.length>=50){$.dialog.alert("原因长度不能大于50个字");return false}var e=[{name:"type",value:0},{name:"userid",value:clickuid},{name:"username",value:d},{name:"limittime",value:0},{name:"reason",value:f}];var g=Sttencode(e);thisMovie("WebRoom").js_keyTitles(g)},cancelVal:"关闭",cancel:true})},chat_report:function(){var d=!$SYS.uid?touristuid:$SYS.uid;if(d==clickuid){$.dialog.alert("不能举报自已!");return false}if(click_chatid==""||click_chatid.length<=1){$("#itemopen").hide();return false}var c=[{name:"suid",value:clickuid},{name:"rid",value:$ROOM.room_id},{name:"chatmsgid",value:click_chatid}];var e=Sttencode(c);thisMovie("WebRoom").js_reportBarrage(e);$("#itemopen").hide()}};function weight_conversion(c){if(c<1000){return c+"g"}else{if(c<1000000){return(c/1000)+"kg"}else{return(Math.round(c/10000)/100)+"t"}}}function get_leve_info(c){return_arr=new Array();$.each(room_args.leve_json,function(d,e){e.score=parseInt(d);return_arr.next=e;if(c<parseInt(d)){return false}return_arr.current=e});return return_arr}var roomgroup_obj={add:function(c,d,e){c=parseInt(c);d=parseInt(d);e=parseInt(e);if(roomgrouplist[c]==undefined){roomgrouplist[c]=new Array()}roomgrouplist[c]["roomgroup"]=d;roomgrouplist[c]["pg"]=e}};var remind_obj={senior_remind:function(i){var c=Sttdecode(i);var h=parseInt(getsttdata(c,"m_deserve_lev"));var e=parseInt(getsttdata(c,"cq_cnt"));var j="欢迎 ";var f=get_leve_info(parseInt(c[8]["value"]));var g=parseInt(getsttdata(c,"best_dlev"));if(h>0&&e>0){j+='<span class="cq_level c_lv'+h+'"><img src="'+$SYS.res_url+"douyu/images/cq_no0"+h+".png?"+$SYS.res_ver+'"><em>×'+e+"</em></span>"}else{if(g>0){j+='<img src="'+$SYS.res_url+'douyu/images/cq_other.png">'}else{j+=return_img("classtype",f.current.pic)}}j+=' <a style="color:#F00" class="js_nick" rel="'+c[0]["value"]+'" >'+c[2]["value"]+"<a/> 来到本直播间";var d=add_ttlist("chat_line_list");$(d).addClass("cqback");d.html(j);roomgroup_obj.add(c[0]["value"],c[3]["value"],c[5]["value"]);if($("#cscroll").data("stat")){scrdown("chat_lines")}},taskmsg_scroll:function(c){$("#taskmsg").finish();$("#taskmsg").css({bottom:"52px"});$("#taskul").html("<li><span><i>"+c+"</i></span></li>");$("#taskmsg").show();$("#taskmsg").animate({bottom:"110px"},1000,function(){setTimeout(function(){$("#taskmsg").fadeOut()},5000)})},clear_show:function(){$("#clear_show_div,#clear_show_back").show();$("#clear_show_div .lead_txt").hide();$("#clear_show_div  .lead_txt").eq(0).show();setTimeout("window.location.reload();",60000)},clear_login_show:function(){$("#clear_show_div,#clear_show_back").show();$("#clear_show_div  .lead_txt").hide();$("#clear_show_div  .lead_txt").eq(1).show()},closed_clear:function(){$("#clear_show_div,#clear_show_back").hide()}};var gift_switch=1;var ywzy=0;var gift_obj={retutn_gift:function(j){var l=Sttdecode(j);var u=check_user_login();var c=Sttdecode(l[5]["value"]);if(window.roomBatterFxRender){var t,j={};for(var k=0;k<l.length;k++){t=l[k];j[t.name]=t.value}j.user={};for(var k=0;k<c.length;k++){t=c[k];j.user[t.name]=t.value}roomBatterFxRender(j)}if(c[0]["value"]==u.wl_uid){gift_switch=1}if(l[0]["value"]==218){var f=document.createElement("p");$(f).html("<span>请先绑定手机！</span>");$("#ywbztit").append(f);$(f).animate({bottom:"50px"},1000);$(f).fadeOut("slow",function(){$(f).remove()});return false}if(l[0]["value"]==283&&(c[0]["value"]==u.wl_uid)){if(ywzy==0&&($("#rwshow").length>0)){$("#rwshow,#back").show();$("#back").height($("#main_col").outerHeight(true));var s=$("#rwbut").offset();$("#rwshow").offset({top:s.top-255,left:s.left-6});$(window).resize(function(){var i=$("#rwbut").offset();$("#rwshow").offset({top:i.top-255,left:i.left-6});$("#back").height($("#main_col").outerHeight(true))});ywzy=1}else{var f=document.createElement("p");$(f).html("<span >鱼丸不足！</span>");$("#ywbztit").append(f);$(f).animate({bottom:"50px"},1000);$(f).fadeOut("slow",function(){$(f).remove()});ywzy++;if(ywzy>=10){ywzy=0}}return false}if(l[0]["value"]==0){if(roomgrouplist[c[0]["value"]]==undefined){roomgrouplist[c[0]["value"]]=new Array()}roomgrouplist[c[0]["value"]]["roomgroup"]=c[3]["value"];if(c[0]["value"]==u.wl_uid){var f=document.createElement("p");zdl=parseInt(l[2]["value"]/100);$(f).html("<span>战斗力+"+zdl+"！</span>");$("#ywbztit").append(f);$(f).animate({bottom:"50px"},1000);$(f).fadeOut("slow",function(){$(f).remove()});ywzy++;if(room_args.rpc_switch&&typeof(l[6])!="undefined"&&l[6]["value"]!=""){var h=get_leve_info(parseInt(l[6]["value"]));$("#leftlever").html(return_img("classtype",h.current.pic));var n=parseInt(l[6]["value"]/100);if(h.next.score!=h.current.score){$("#leftlever").attr("title","下一级："+h.next.name);var m=Math.ceil((h.next.score-l[6]["value"])/100);var q='<div class="arrow"></div>还差<i>'+m+"</i>个战斗力可以升为<i>["+h.next.name+"]</i><br />";$("#leverline").css("width",parseInt((l[6]["value"]-h.current.score)/(h.next.score-h.current.score)*100)+"%");$("#leverscore").html(n+"/"+parseInt(h.next.score/100))}else{var q='<div class="arrow"></div>哇靠，已经是<i>【最强王者】</i>了~^~';$("#leverline").css("width","100%");$("#leverscore").html(n+"/"+n)}$("#bartit").html(q)}}if(room_args.rpc_switch&&typeof(l[7])!="undefined"&&l[7]["value"]!=""){$("#weighttit").html(weight_conversion(parseInt(l[7]["value"])))}if(!$("#blackgift").is(":checked")||(c[0]["value"]==u.wl_uid)){if(l[2]["value"]<10&&(c[0]["value"]!=u.wl_uid)){return false}var h=get_leve_info(parseInt(l[6]["value"]));var r=return_img("classtype",h.current.pic);var e=parseInt(getsttdata(c,"cur_lev"));var v=parseInt(getsttdata(c,"cq_cnt"));var d=parseInt(getsttdata(c,"best_dlev"));if(e>0&&v>0){r+='<span class="cq_level c_lv'+e+'"><img src="'+$SYS.res_url+"douyu/images/cq_no0"+e+".png?"+$SYS.res_ver+'"><em>×'+v+"</em></span>"}else{if(d>0){r+='<img src="'+$SYS.res_url+'douyu/images/cq_other.png">'}}switch(parseInt(l[2]["value"])){case 520:r+=' <a href="#" class="nick js_nick" rel='+c[0]["value"]+" >"+c[2]["value"]+'</a><br />赠送给主播<i><img src="'+$SYS.res_url+"douyu/images/zs"+parseInt(l[2]["value"])+".png?"+$SYS.res_ver+'"></i>个鱼丸'+return_img("coin","yw520.png?20150430");break;case 1000:r+=' <a href="#" class="nick js_nick" rel='+c[0]["value"]+" >"+c[2]["value"]+'</a><br />赠送给主播<i><img src="'+$SYS.res_url+"douyu/images/zs"+parseInt(l[2]["value"])+".png?"+$SYS.res_ver+'"></i>个鱼丸'+return_img("coin","h1000.gif?20150430");break;case 2333:r+=' <a href="#" class="nick js_nick" rel='+c[0]["value"]+" >"+c[2]["value"]+'</a><br />赠送给主播<i><img src="'+$SYS.res_url+"douyu/images/zs"+parseInt(l[2]["value"])+".png?"+$SYS.res_ver+'"></i>个鱼丸'+return_img("coin","h2333.gif?20150430");break;case 6666:r+=' <a href="#" class="nick js_nick" rel='+c[0]["value"]+" >"+c[2]["value"]+'</a><br />赠送给主播<i><img src="'+$SYS.res_url+"douyu/images/zs"+parseInt(l[2]["value"])+".png?"+$SYS.res_ver+'"></i>个鱼丸'+return_img("coin","h6666.gif?20150430");break;case 10000:r+=' <a href="#" class="nick js_nick" rel='+c[0]["value"]+" >"+c[2]["value"]+'</a><br />赠送给主播<i><img src="'+$SYS.res_url+"douyu/images/zs"+parseInt(l[2]["value"])+".png?"+$SYS.res_ver+'"></i>个鱼丸'+return_img("coin","h10000.gif?20150430");break;case 88888:r+=' <a href="#" class="nick js_nick" rel='+c[0]["value"]+" >"+c[2]["value"]+'</a><br />赠送给主播<i><img src="'+$SYS.res_url+"douyu/images/zs"+parseInt(l[2]["value"])+".png?"+$SYS.res_ver+'"></i>个鱼丸'+return_img("coin","h88888.gif?20150430");break;case 99999:r+=' <a href="#" class="nick js_nick" rel='+c[0]["value"]+" >"+c[2]["value"]+'</a><br />赠送给主播<i><img src="'+$SYS.res_url+"douyu/images/zs"+parseInt(l[2]["value"])+".png?"+$SYS.res_ver+'"></i>个鱼丸'+return_img("coin","h99999.gif?20150430");break;default:r+=' <a href="#" class="nick js_nick" rel='+c[0]["value"]+" >"+c[2]["value"]+"</a>赠送给主播<i>"+l[2]["value"]+"</i>个鱼丸"+return_img("coin","yw.png?20150430");break}var g=add_ttlist("chat_line_list");$(g).html(r);if(l[2]["value"]==88888||l[2]["value"]==99999){gift_obj.get_super_obj(c[2]["value"],l[2]["value"])}if(($("#cscroll").data("stat"))||(c[0]["value"]==u.wl_uid)){scrdown("chat_lines")}}var u=check_user_login();if(c[0]["value"]==u.wl_uid){if($("#header").length>0){$("#ywtit").html("鱼丸 "+number_format(l[4]["value"]))}else{$("#ywtit").html(number_format(l[4]["value"]))}$("#ywtit").data("value",l[4]["value"])}}},get_super_obj:function(c,e){var d=document.createElement("div");var f=' <div class="n_rew fl"><a href="#" class="n_player fl">'+c+"</a><em>送给主播</em>";switch(parseInt(e)){case 88888:$(d).addClass("super_rew");f+='<p class="n_pic fl"><img class="fl" src="'+$SYS.res_url+'douyu/images/cq_88.png"><span>个鱼丸</span></p></div><p class="dy_pic"><img class="fl" src="'+$SYS.res_url+'douyu/images/cj88888.gif"></p>';break;case 99999:$(d).addClass("super_rew super_yw");f+='<p class="n_pic fl"><img class="fl" src="'+$SYS.res_url+'douyu/images/cq_99.png"><span>个鱼丸</span></p></div><p class="dy_pic"><img class="fl" src="'+$SYS.res_url+'douyu/images/cj99999.gif"></p>';break}$(d).html(f);gift_obj.super_show(d)},super_show:function(d){return;var c=$("body").data("view")?308:298;if($("#right_col").is(":hidden")){return false}if($("#chat_lines").height()<80){return false}$("#super_show").append(d);if($("#chat_lines").height()<($(".super_rew").length*80)){$(".super_rew").eq(0).remove()}$(d).animate({width:c+"px"},500).delay(1500).fadeOut(500,function(){$(d).remove()})},send_very_gift:function(c){if(!check_login()){return false}if(gift_switch==1){var d=/^([1-9]\d*)$/;if(!d.test(c)){$.dialog.tips_black("请输入整数");return false}var e=[{name:"type",value:"donatereq"},{name:"ms",value:c}];var f=Sttencode(e);thisMovie("WebRoom").js_givePresent(f);gift_switch=0}},send_gift:function(){if(!check_login()){return false}if(gift_switch==1){num=$("#giftbut").data("num");num=!num?100:num;var c=/^([1-9]\d*)$/;if(!c.test(num)){$.dialog.tips_black("请输入整数");return false}var d=[{name:"type",value:"donatereq"},{name:"ms",value:num}];var e=Sttencode(d);thisMovie("WebRoom").js_givePresent(e);gift_switch=0}}};var tip_num=0;function tip_show(c){if(tip_num<=5){if($("#"+c).is(":hidden")){$("#"+c).show()}else{$("#"+c).hide()}tip_num++;setTimeout('tip_show("'+c+'")',500)}else{tip_num=0;$("#"+c).hide()}}function htmlswitch(c){if($("#"+c).is(":hidden")){$("#"+c).show()}else{$("#"+c).hide()}}function check_login(){var c=check_user_login();if(!c){user_dialog.open_login();return false}return true}function check_user_login(){var c=new Array();c.wl_uid=$SYS.uid;c.wl_username=$SYS.username;c.wl_auth=get_cookie("auth_wl");if(!c.wl_username&&!c.wl_auth){return false}else{return c}}function return_img(e,d){var c="";switch(e){case"coin":c="<img  src="+$SYS.res_url+"douyu/images/"+d+"  />";break;case"classtype":c="<img  src="+$SYS.res_url+"douyu/images/classimg/"+d+"  />";break;case"roomadmin":c="<img  src="+$SYS.res_url+"douyu/images/"+d+".gif?20140704  />";break;case"anchorimg":c="<img  src="+$SYS.res_url+"douyu/images/"+d+".gif?20140704  />";break;case"superadmin":c="<img  src="+$SYS.res_url+"douyu/images/super_admin.gif?20140704  />";break}return c}function html_encode(d){var c="";if(d.length==0){return""}c=d.replace(/&/g,"&amp;");c=c.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");c=c.replace(/ /g,"&nbsp;");c=c.replace(/\'/g,"&#39;");c=c.replace(/\"/g,"&quot;");c=c.replace(/\s/g," ");return c}function scrdown(c){$("#"+c).scrollTop($("#"+c).prop("scrollHeight"))}function get_scrd(){return($("#chat_lines").prop("scrollHeight")-$("#chat_lines").scrollTop())<=$("#chat_lines").height()?1:0}function ctrlclear(d){$("#"+d).find(".jschartli").remove();var c=add_ttlist("chat_line_list");c.html('<span style="color:#ff0000;">已清空所有弹幕内容</span>')}function facereplace(g){var f=new Array("good","kiss","drop","fil","grief","badluck","indecent","kiss","laugh","lovely","rage","scare","sleep","trick","awesome","snicker","doubt","guise","sorry","nosebleed","moving","grimace","laughing","revel","excited","dizzy","bye","up","a","dzt","js","kx","uccu","wy","dyfn","dyw","dyhp","dycy","dylb","dyjj","dydoge","dylyl","dyhc","dytk","dysyw");var d=f.length;for(a=0;a<d;a++){var e="\\[emot:"+f[a]+"\\]";var c='<img rel="'+f[a]+'" src="'+$SYS.res_url+"douyu/images/face/"+f[a]+'.gif" />';g=g.replace(new RegExp(e,"g"),c)}return g}function dyfacereplace(h){var g=new Array("dy001","dy002","dy003","dy004","dy005","dy006","dy007","dy008","dy009","dy010","dy011","dy012","dy013","dy014","dy015","dy016","dy017","dy101","dy102","dy103","dy104","dy105","dy106","dy107","dy108","dy109","dy110","dy111","dy112","dy113","dy114","dy115","dy116","dy117","dy118","dy119","dy120","dy121","dy122","dy123","dy124","dy125","dy126","dy127","dy128");var d=g.length;for(a=0;a<d;a++){var f="\\[emot:"+g[a]+"\\]";var c='<img rel="'+g[a]+'" src="'+$SYS.res_url+"douyu/images/dyface/"+g[a]+'.gif" />';h=h.replace(new RegExp(f,"g"),c)}var e=new Array("good","kiss","drop","fil","grief","badluck","indecent","kiss","laugh","lovely","rage","scare","sleep","trick","awesome","snicker","doubt","guise","sorry","nosebleed","moving","grimace","laughing","revel","excited","dizzy","bye","up","a","dzt","js","kx","uccu","wy","dyfn","dyw","dyhp","dycy","dylb","dyjj","dydoge","dylyl","dyhc","dytk","dysyw");var i=e.length;for(a=0;a<i;a++){var f="\\[emot:"+e[a]+"\\]";var c='<img rel="'+e[a]+'" src="'+$SYS.res_url+"douyu/images/face/"+e[a]+'.gif" />';h=h.replace(new RegExp(f,"g"),c)}return h}function getValue(c,g,f){var e=document.getElementById(c);var d=f==1?cursurposition:buglecursurposition;e.value=e.value.substring(0,d)+g+e.value.substring(d);e.focus()}function getTxt1CursorPosition(d,e){var f=document.getElementById(d);if(!document.selection){if(e==1){cursurposition=f.selectionStart}else{buglecursurposition=f.selectionStart}}else{var c=document.selection.createRange();c.moveStart("character",-f.value.length);if(e==1){cursurposition=c.text.length}else{buglecursurposition=c.text.length}}}function proptitle_show(c){$("#proptitle").html(c);$("#proptitle").show()}function htmldecode(f){var d="";var e=new Array();f=f.substr(0,f.length-3);var c=f.split("/@/");$.each(c,function(j,k){var i=k.split("/");var n="";var g="";var h="";var m="";var l="";$.each(i,function(q,r){var p=r.split("@=");switch(p[0]){case"type":n=p[1];break;case"str":h=p[1];break;case"imgtype":m=p[1];break;case"src":l=p[1];break;default:g+=" "+p[0]+'="'+p[1]+'"'}});if(m){switch(m){case"classtype":l=$SYS.res_url+"images/classimg/"+l+".gif";break}}if(n=="str"){d+=h}else{d+="<"+n+" "+g;if(l){d+=" src="+l}d+=">";d+=h}d+=n!="img"&&n!="str"?"</"+n+">":"";d+=" "});return d}function htmlshow(f){var e=f.split("||");var d=e[0].split("@=")[1];switch(d){case"public":var c=add_ttlist("chat_line_list");break}var g=e[1].split("/@/").length>1?htmldecode(e[1]):e[1];c.html(g)}function dialog_pay(){$.dialog({content:"鱼翅余额不足,点击获取!",icon:"warning",okVal:"是",ok:function(){window.open("/web_game/welcome/18")},cancelVal:"否",cancel:function(){}})}function popUp(e,d){if($("#header").length>0){var c=90;if(!$("body").data("view")){c=15}if(typeof(is_topic_page)=="undefined"){if($("#details_show").length>0){d=d+c+$("#details_div").height()}else{d=d+c}}}$("#itemopen").show();$("#itemopen").css("top",d);$("#itemopen").css("left",e)}function menu_show(e){var d=!$SYS.uid?touristuid:$SYS.uid;clickuid=$(e).attr("rel");var c=$(e).attr("gid");clicknickuser=$(e).html();click_chatid=$(e).parent().next().attr("chatid");if(click_chatid==null||click_chatid==""||Number(c)>=5){$("#user_report").hide()}else{$("#user_report").show()}$(".js_login_myroom_ip").hide();if((roomgrouplist[d]["roomgroup"]>=4&&roomgrouplist[clickuid]["roomgroup"]<4)||(roomgrouplist[clickuid]["roomgroup"]<4&&$SYS.groupid==5)){$("#black_img").show();if(($SYS.groupid==5)||($SYS.uid==$ROOM.owner_uid)){$(".js_login_myroom_ip").show()}}else{$("#black_img").hide()}if(roomgrouplist[clickuid]["pg"]==5){$("#black_img").hide()}$("#adminsetup").hide();if(roomgrouplist[d]["roomgroup"]==5||($SYS.groupid==5&&roomgrouplist[clickuid]["roomgroup"]<5)){$("#adminsetup").show();if(roomgrouplist[clickuid]["roomgroup"]==4){$("#adminsetup").html("解除管理员");$("#adminsetup").attr("rel",1)}else{$("#adminsetup").html("任命管理员");$("#adminsetup").attr("rel",4)}}if(jQuery.inArray(parseInt(clickuid),user_black_list)>-1){$("#user_black").html("取消屏蔽");$("#user_black").attr("rel",1)}else{if(user_black_list.length>=10){$("#user_black").html("屏蔽人数已满");$("#user_black").attr("rel",3)}else{$("#user_black").html("屏蔽该用户");$("#user_black").attr("rel",0)}}}function adminreg(){var c=[{name:"type",value:"setadminreq"},{name:"userid",value:clickuid},{name:"group",value:$("#adminsetup").attr("rel")}];var d=Sttencode(c);thisMovie("WebRoom").js_setadmin(d)}function return_setadmin(f){var c=Sttdecode(f);var e="";if(c[0]["value"]==0){e+=' <a class="js_nick"  rel='+c[1]["value"]+' style="color:#FF0000" >'+c[4]["value"]+"</a>";e+=c[2]["value"]>1?'<span style="color:#FF0000">被任命管理员身份。</span>':'<span style="color:#FF0000">被罢免管理员身份。</span>';if(roomgrouplist[c[1]["value"]]==undefined){roomgrouplist[c[1]["value"]]=new Array()}roomgrouplist[c[1]["value"]]["roomgroup"]=c[2]["value"]}else{if(c[0]["value"]==214){e='<span style="color:#FF0000">管理员数量以达上限。</span>'}}del_ttlist(1000);var d=add_ttlist("chat_line_list");d.html(e);if($("#cscroll").data("stat")){scrdown("chat_lines")}}function return_onekeyblack(f){var c=Sttdecode(f);var e="";if(c[1]["value"]==0){e='<span style="color:#FF0000;">已对 '+c[0]["value"]+" 进行一键封号</span>"}else{e='<span style="color:#FF0000;">对 '+c[0]["value"]+" 进行一键封号失败,错误码:"+c[1]["value"]+"</span>"}del_ttlist(1000);var d=add_ttlist("chat_line_list");d.html(e);if($("#cscroll").data("stat")){scrdown("chat_lines")}}function open_black(){$("#blacknick").html(clicknickuser);$.dialog({title:"用户屏蔽",content:document.getElementById("blackshow"),icon:"warning",id:"black900l",ok:function(){return black_user_send("black_send")},cancelVal:"关闭",cancel:true});$("#blacktime").focus();return false}function black_user_send(f){if(!check_user_login()){return false}var e=0;if(f=="black_send"){e=$("#blacktime").val();if(isNaN(e)||e<=0){$.dialog.tips_black("请重新输入!");return false}var d=$('input[name="range"]:checked').val();var c=$('input[name="blacktype"]:checked').val();if(d==2){c=c==2?4:1;if(e>99){$.dialog.tips_black("封禁时长不能超过99小时!");return false}}else{if(e>720){$.dialog.tips_black("封禁时长不能超过720小时!");return false}if(roomgrouplist[clickuid]["roomgroup"]==0){return false}}e=e*3600}else{var c=roomgrouplist[clickuid]["blackgroup"]}var g=[{name:"type",value:"blackreq"},{name:"userid",value:clickuid},{name:"blacktype",value:c},{name:"limittime",value:e}];var h=Sttencode(g);$("#blacktime").val(99);thisMovie("WebRoom").js_blackuser(h)}function saidhim(){var d=$SYS.uid;if(clickuid==d){return false}if(jQuery.inArray(clickuid,saiduserlist)<0&&roomgrouplist[clickuid]["roomgroup"]!=5){if(saiduserlist.length==10){$("a[name='userchoice']").eq(2).remove();saiduserlist.splice(0,1)}var c=jQuery("<li></li>");$("#userul").append(c);c.html('<a name="userchoice" rel="'+clickuid+'">'+clicknickuser+"</a>");saiduserlist.push(clickuid)}$("#selectdel").show();$("#selectsb").html(clicknickuser);$("#privateuid").val(clickuid)}function privatecheck(){var c=check_user_login();if(c.wl_uid==clickuid){return false}$("#privateuid").val(clickuid);$("#privatstate").val("private");$("#selectsb").html(clicknickuser);$("#selectdel").show();$("#in_check").removeClass("switch-off");$("#in_check").addClass("switch-on")}function broadcast_show(c){broadcast.show(c)}var broadcast={show:function(h){if($("#broadcast_div").length==0){return false}var e=Sttdecode(h);var d=e[3]["value"];d=d.replace(new RegExp("@s","g"),"/");d=d.replace(new RegExp("@a","g"),"@");var g=e[4]["value"];g=g.replace(new RegExp("@s","g"),"/");g=g.replace(new RegExp("@a","g"),"@");var f="";f+=g?'<a href="'+g+'"  target="_blank" >'+d+"</a>":d;$("#broadcast_show").html(f);if(typeof(is_topic_page)=="undefined"){$("#broadcast_div").show()}var c=parseInt($("#chat_lines").css("height"));set_live_height();if($("#header").length>0){set_right_height()}setTimeout("broadcast.hide()",30000)},hide:function(){$("#broadcast_div").hide();var c=parseInt($("#chat_lines").css("height"));set_live_height();if($("#header").length>0){set_right_height()}}};function chart_focus(){$("#chart_content").focus()}function get_interval_time(c){if(c>=3000){return 480}else{if(c>=2000){return 240}else{if(c>=1000){return 60}else{if(c>=501){return 15}else{if(c>=201){return 8}else{return 3}}}}}}function get_send_length(c){if(c<=500){return 50}else{if(c<=1000){return 40}else{if(c<=2000){return 30}else{return 20}}}}var lastcontent="";function room_link_check(f){var c=/\[room\=([^\]]+)\]/ig;var e=f.match(c);var d=1;if(e){$.each(e,function(h,j){var g=/\[room\=([a-z\d]+)\]/ig;if(!g.test(j)){d=0;return false}})}return d}function sendmsg(){var h=Date.parse(new Date())/1000;if((h-sendtime)<=send_interval_time){return false}var i=$("#chart_content").val();if(i==""){setTimeout("chart_focus()",100);return false}var c=check_user_login();if(!c){user_dialog.open_login();return false}if(lastcontent==i){msg_show("请不要重复发言。");return false}if(!room_link_check(i)){msg_show("您输入的代码中含有非法字符，请重新输入。");return false}var d=barrage_color;if(checkemot(i)){d=0}var g=[{name:"content",value:scan_str(i)},{name:"scope",value:$("#privatstate").val()},{name:"col",value:d}];lastcontent=i;var e=!c?touristuid:c.wl_uid;g.push({name:"sender",value:e});if($("#privateuid").val()>0){g.push({name:"receiver",value:$("#privateuid").val()})}var j=Sttencode(g);$("#chart_content").val("");try{thisMovie("WebRoom").js_sendmsg(j)}catch(f){}sendtime=h;sendinterval();setTimeout("chart_focus()",100)}function numtorgbstr(c){var d=parseInt(c);return"rgb("+parseInt(d%256)+","+(parseInt((d/256))%256)+","+(parseInt((d/256/256))%256)+");"}function checkemot(e){var d="[emot:[A-Za-z0-9_]+]";var c="";c=e.replace(new RegExp(d,"g"),"");if(c===""){return true}else{return false}}var usercount=0;function room_usercount(d){var c=parseInt(d);usercount=c;$("#ol_num").html(number_format(c))}var intervalobj;function sendinterval(){if(send_interval_time>0){bttime()}}function bttime(){$(".b_btn").css({background:"#888",color:"#fff"});$(".cs_btn").css({background:"#888",color:"#fff"});$("#sendmsg").attr("disbaled",true);if(typeof(window.send_btn)=="undefined"||window.send_btn==""){window.send_btn=$("#sendmsg").html()}$("#sendmsg").html('<span style="color:#fff">&nbsp;&nbsp;'+intervaltime+"&nbsp;&nbsp;</span>");if(intervaltime<=0){$(".b_btn").removeAttr("style");$(".cs_btn").removeAttr("style");$("#sendmsg").html(window.send_btn);$("#sendmsg").attr("disbaled",false);intervaltime=send_interval_time}else{intervaltime--;setTimeout("bttime()",1000)}}function add_ttlist(d){var c=document.createElement("li");$(c).addClass("jschartli");c.innerHTML=' <p class="text_cont"></p>';$("#"+d).append(c);return $(c).find("p")}function del_ttlist(d){var c=$(".jschartli").length;if(c>=d){$(".jschartli").eq(0).remove()}}function getsttdata(c,e){for(var d in c){if(c[d].name==e){return c[d].value}}return null}function returnmsg(B){var n=Sttdecode(B);var c=getsttdata(n,"rescode");var l=getsttdata(n,"sender");var w=getsttdata(n,"col");var j=check_user_login();var e=!j?touristuid:j.wl_uid;str=getsttdata(n,"content");var k=false;if((c>0)&&(parseInt(l)==e)){var A="";switch(c){case"289":A="请不要重复发言。";break;case"290":A="您的发言速度过快....";break;case"294":k=true;break}if(A){msg_show(A)}}if(k){$.dialog({content:"鱼翅余额不足，点击获取！",icon:"warning",okVal:"确定",ok:function(){window.location.href="/web_game/welcome/18"},cancelVal:"取消",cancel:function(){}});return false}if(c>0){return false}if(!room_link_check(str)){return false}if(($SYS.uid!=$ROOM.owner_uid)&&$SYS.groupid!=5){document.getElementById("chart_content").maxLength=n[13]["value"];maxcontent=getsttdata(n,"maxl")}else{maxcontent=200}if(jQuery.inArray(parseInt(l),user_black_list)!=-1){return false}var y=parseInt(getsttdata(n,"m_deserve_lev"));var v=parseInt(getsttdata(n,"cq_cnt"));var q=document.createElement("li");if(y>0&&v>0){var p='<p class="my_cont cqback">'}else{var p='<p class="my_cont">'}$(q).addClass("jschartli");if(l!=e){$(q).addClass("chartli");if(y>0&&v>0){var p='<p class="text_cont cqback">'}else{var p='<p class="text_cont">'}}var f=getsttdata(n,"ct");var g=$("body").data("page");if((g!="qqapp")){if((parseInt(f)==1)||(parseInt(f)==2)){p+='<span><a href="/client" target="_blank" title="【来自于斗鱼移动端】"><img  src='+$SYS.res_url+"douyu/images/mobile.png /></a></span>"}}if(parseInt(getsttdata(n,"sender_pg"))==5){p+="<span>"+return_img("superadmin","")+"</span>"}else{switch(getsttdata(n,"sender_rg")){case"4":p+="<span>"+return_img("roomadmin","roomadmin")+"</span>";break;case"5":p+="<span>"+return_img("anchorimg","anchor")+"</span>";break}}var r=parseInt(getsttdata(n,"best_dlev"));if(y>0&&v>0){p+='<span class="cq_level c_lv'+y+'"><img src="'+$SYS.res_url+"douyu/images/cq_no0"+y+".png?"+$SYS.res_ver+'"><em>×'+v+"</em></span>"}else{if(r>0){p+='<img src="'+$SYS.res_url+'douyu/images/cq_other.png">'}}p+='<span class="name">';p+='<a href="#" class="nick js_nick" rel='+l+" gid="+getsttdata(n,"sender_pg")+">";var x=(getsttdata(n,"sender_nickname")||getsttdata(n,"snick"));p+=x+":";p+="</a></span>";var m="";if(parseInt(getsttdata(n,"sender_pg"))<5){m=getsttdata(n,"chatmsgid")}var z="text_cont";if(l==e){z="m"}var u="";w=parseInt(w);if(w>=1&&w<=6){u='style="color:'+getcolorbyindex(w)+'"'}p+='<span class="'+z+'" '+u+' chatid="'+m+'">';str=html_encode(str);str=dyfacereplace(str);var t=/\[room\=([a-zA-Z\d]+)\]/ig;var h='<img src="'+$SYS.res_url+'douyu/images/link.png">';str=str.replace(t,'<a href="/$1" target="_blank" class="cont_room">'+h+"$1</a>");p+=str+"</span></p>";$("#chat_line_list").append(q);$(q).html(p);del_ttlist(1000);var d=getsttdata(n,"level");var i=getsttdata(n,"roomgroup");if(roomgrouplist[l]==undefined){roomgrouplist[l]=new Array()}roomgrouplist[l]["roomgroup"]=getsttdata(n,"sender_rg");roomgrouplist[l]["pg"]=getsttdata(n,"sender_pg");if((l==e)&&$SYS.groupid!=5&&($SYS.uid!=$ROOM.owner_uid)){var s=parseInt(getsttdata(n,"cd"));if(s!=send_interval_time){if(s>intervaltime){intervaltime=s}}if(send_interval_time==0){bttime()}send_interval_time=s}if((l==e)||($("#cscroll").data("stat"))){scrdown("chat_lines")}}function return_chatreport(e){var d=Sttdecode(e);var c="";if(Number(getsttdata(d,"state"))==1){c='<span class=""><p>您已成功举报了弹幕！<p><br />超管在后台确认该弹幕违规后，会对弹幕发言人<br />进行相应的处理，并对首位举报该弹幕的用户赠<br />送100鱼丸。 鱼丸会直接发放到帐号上，无需通<br />过任务大厅领取。</span>'}else{c='<span class="">举报失败</span>'}$.dialog.alert(c)}function return_recevice_pm(f){var c=Sttdecode(f);var d=Number(getsttdata(c,"unread"));if(!isNaN(d)){if(d>0){$("#js_member_pic b.letter_dian").show()}else{$("#js_member_pic b.letter_dian").hide()}}var e=getsttdata(c,"mid");var f=[{name:"mid",value:e}];var g=Sttencode(f);thisMovie("WebRoom").js_pmFeedback(g)}function return_sys_msg(c){var d="系统广播: "+c;msg_show(d)}function msg_show(d){var c=add_ttlist("chat_line_list");c.html('<a style="color:#FF0000">'+d+"</a>");if($("#cscroll").data("stat")){scrdown("chat_lines")}}function return_yc(f){var c=Sttdecode(f);var e=getsttdata(c,"type");var d=getsttdata(c,"b");$("#yctit").html("鱼翅 "+number_format(d/100)).data("value",d)}function getcolorbyindex(c){return barrage_color_list[c-1]}function logprompt(f){var c=Sttdecode(f);if(c[3]["value"]==0){return false}var e="";if(roomgrouplist[c[0]["value"]]["roomgroup"]<=1){return false}e+=' <a href="#" class="nick js_nick" rel='+c[0]["value"]+" >"+c[1]["value"]+"</a>进入房间";roomgrouplist[c[0]["value"]]=new Array();roomgrouplist[c[0]["value"]]["roomgroup"]=c[3]["value"];roomgrouplist[c[0]["value"]]["classtype"]=c[2]["value"];del_ttlist(1000);var d=add_ttlist("chat_line_list");d.html(e);if($("#cscroll").data("stat")){scrdown("chat_lines")}}function online_userlist(e){$("#user_list").html("");var h=Sttdecode(e);var f=11;var k=(h.length-1)/f;for(var m=0;m<k;m++){var j=h[m*f+1]["value"];var g=h[m*f+3]["value"];var n=h[m*f+8]["value"];roomgrouplist[j]=new Array();roomgrouplist[j]["roomgroup"]=h[m*f+4]["value"];roomgrouplist[j]["classtype"]=h[m*f+8]["value"];roomgrouplist[j]["blackgroup"]=h[m*f+5]["value"];var i="";if(h[m*f+5]["value"]>0){i='<span class="level_icon"><img src="'+$SYS.res_url+'new_style2/images/black.gif " class="black"></span>'}var d=h[m*f+4]["value"]>1&&h[m*f+4]["value"]<5?'<span class="level_icon">'+return_img("roomadmin","roomadmin")+"</span>":"";d+=h[m*f+4]["value"]==5?'<span class="level_icon">'+return_img("anchorimg","anchor")+"</span>":"";d+='<span class="level_icon">'+return_img("classtype",n)+"</span>";d='<p class="fixed">'+i+d+"</p>";var l='<p class="fixed"><a href="#" rel="'+j+'" class="username js_nick" >'+g+"</a></p>";var c=document.createElement("li");if(m%2!=0){$(c).addClass("b")}$("#user_list").append(c);$(c).html(d+l)}}function online_adminlist(e){$("#admin_list").html("");var h=Sttdecode(e);var f=11;var m=(h.length-1)/f;for(var k=0;k<m;k++){var i=h[k*f+1]["value"];var g=h[k*f+3]["value"];var l=h[k*f+8]["value"];var d=h[k*f+4]["value"]==5?'<span class="level_icon">'+return_img("anchorimg","anchor")+"</span>":'<span class="level_icon">'+return_img("roomadmin","roomadmin")+"</span>";d+='<span class="level_icon">'+return_img("classtype",l)+"</span>";d='<p class="fixed">'+d+"</p>";var j='<p class="fixed"><a class="js_nick" href="#" rel="'+i+'">'+g+"</a></p>";var c=document.createElement("li");if(k%2!=0){$(c).addClass("b")}$("#admin_list").append(c);$(c).html(d+j)}}function room_cachedmsg(f){var h=Sttdecode(f);var e=document.getElementById("giftlist");e.innerHTML="";var g=(h.length-1)/7>10?10:(h.length-1)/7;for(var m=0;m<g;m++){var d=h[m*7+3]["value"];var l=h[m*7+5]["value"];var i=h[m*7+6]["value"];var j=document.createElement("li");e.appendChild(j);var c=propname_list[h[m*7+1]["value"]]["name"];var k=icon_list[h[m*7+1]["value"]];$(j).html(l+" 收到了 "+d+" 送来的 "+i+"个"+c+' <img width="28" height="28" src='+$SYS.res_url+"images/item/"+k+" />")}}function room_propstatist(f){var d=f.split("type@=cashgift/");var g=new Array();g[0]=d[0].split("type@=prop/")[1];g[1]=d[1].split("type@=sofa/")[0];g[2]=d[1].split("type@=sofa/")[1];$("#liwu").html("");for(a=0;a<3;a++){var j=Sttdecode(g[a]);var h=4;var c=(j.length-1)/h;for(b=0;b<c;b++){var i=document.createElement("li");var k='<li><span class="nickname">'+j[b*h+1]["value"]+"</span>";switch(a){case 0:var l=$SYS.res_url+"images/item/"+icon_list[j[b*h+2]["value"]];var e=propname_list[j[b*h+2]["value"]]["name"];break;case 1:var l=$SYS.res_url+"new_style2/images/redbag.png";var e="红包";break;case 2:var l=$SYS.res_url+"new_style2/images/sofa.gif";var e="抢沙发";break}k+='<span class="gift">'+e+'</span><span class="gift_pic"><img src="'+l+'" width="24" height="24" /></span>';k+='<span class="num">'+j[b*h+3]["value"]+"</span>";$("#liwu").append(i);$(i).html(k)}}}function room_giftrank(f){var g=Sttdecode(f);var m="@A";var i=g[1]["value"].replace(new RegExp(m,"g"),"@");var e=new Array();room_rank_list=i.split("//");var h=room_rank_list.length-1;$("#roomrank").html("");var k=1;var c="";for(var l=0;l<h;l++){c+=k==1?'<li class="line"><p>':"";var e=Sttdecode(room_rank_list[l]);var j=icon_list[e[0]["value"]];var d=propname_list[e[0]["value"]]["name"];c+='<span><em><img src="'+$SYS.res_url+"images/item/"+j+'" name="anchorgift" pname="'+d+'" rel="'+e[1]["value"]+'" width="24" height="24"/></em>第'+e[2]["value"]+"</span>";if(l==(h-1)||k==5){c+="</p></li>"}k++;k=k>5?1:k}$("#roomrank").html(c)}function room_bugle_alluser(g){var j=Sttdecode(g);var i=6;var e=(j.length-1)/i;for(var l=0;l<e;l++){var m=document.createElement("span");$(m).addClass("tipItem");var h=j[parseInt(parseInt(l*i)+5)]["value"];h=html_encode(h);var d=new RegExp("<br>","g");h=h.replace(d,"");h=facereplace(h);var k=new Date(j[parseInt(parseInt(l*i)+4)]["value"]*1000);var f=!$.browser.safari?k.toLocaleString().split(" ")[1]:k.toLocaleString().split(" ")[4];var c="";c='<a href="'+j[parseInt(parseInt(l*i)+1)]["value"]+'" target="_blank">';c+='<span class="tipIcon">'+return_img("classtype",j[parseInt(parseInt(l*i)+3)]["value"])+"</span>";c+='<span class="tipName">'+j[parseInt(parseInt(l*i)+2)]["value"]+":</span>";c+="<span>"+h+"</span>";c+='<span class="tipTime">('+f+")</span></a>";$("#bugle").append(m);$(m).html(c);buglesumwidth=$("#bugle").width();if(buglesumwidth>buglewidth){document.getElementById("bugle").style.left=(buglewidth-buglesumwidth)+"px"}}}function scan_str(e){var c="";for(var d=0;d<e.length;d++){if(e.charAt(d)=="\\"){c+="\\\\"}else{c+=e.charAt(d)}}return c}function page_scrn(){if(typeof(is_topic_page)!="undefined"&&$("#mod_player").hasClass("alls")){if($(window).width()>=1400){c=1200}else{c=1000}$("#header").show();$(".video").css("z-Index","0");$("#mod_player").removeClass("alls");$("#content").css("margin","52px auto auto");$("#content").width(c);$("#live_player").height(562);$("#mod_player").width(c-$(".neso_barrage").width()-10);$("#mod_player").height(562);$("body").css({"overflow-y":"auto","overflow-x":"auto"});is_page_screen=0;return false}else{if(typeof(is_topic_page)!="undefined"){is_page_screen=1;var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;$("#header").hide();$(".video").css("z-Index","10000");$("#mod_player").addClass("alls");$("#content").css("margin","0");$("#content").width("100%");$("#mod_player").width("100%");$("#live_player").height(e);$("#mod_player").height(e);$("body").css("overflow-y","hidden");return false}}if($("#live_player .swf_container").hasClass("page_scrn")){$("#live_player").removeClass("alls");$("#live_player .swf_container").removeClass("page_scrn");if($("#left_col").length){$("#left_col").show();$("#main_col").css("overflow-y","scroll");var f=$("#large_nav").is(":visible")?"240px":"49px";if(get_cookie("right_menu")==1){var g=0}else{var g="240px";$("#right_col").show()}$("#main_col").css({"margin-left":f,"margin-right":g})}else{$("#main_col").css({"overflow-y":"auto","overflow-x":"auto"});$("html").css({"overflow-y":"auto","overflow-x":"auto"})}set_window_width();set_live_height();if($("#header").length>0){$("#header").show();set_right_height()}}else{if($("#header").length>0){$("#header").hide();$("#main_col").height($("#main_col").height()+80)}if($("#left_col").length){$("#left_col").hide();$("#right_col").hide();$("#main_col").css({"margin-left":0,"margin-right":0,"overflow-y":"hidden"})}else{$("#main_col").css({"overflow-y":"hidden","overflow-x":"hidden"});$("html").css({"overflow-y":"hidden","overflow-x":"hidden"})}$("#live_player").addClass("alls");var d=$("#main_col").scrollTop()||$(window).scrollTop();$("#live_player").css("top",d);var c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;$("#live_player .swf_container").addClass("page_scrn").height(e);call_resize(c,e)}}function room_gg_verify(){$("#room_gg").html($("#room_gg_verify"));var c=$("#room_gg_verify");var d=c.find(".content");d.html($ROOM.room_gg["verify"]);c.show();if(typeof $ROOM.room_gg["pass"]!="undefined"&&$ROOM.room_gg["pass"]){$("#room_gg_verify .ex span").before("<span style='color: #3c9feb'>【免审】</span>")}$("#room_gg a").unbind("click");c.find(".head a.v_new").bind("click",function(f,e){d.hide("fast",function(){$(this).html($ROOM.room_gg["verify"]);$(this).show("fast",function(){if(typeof e=="undefined"||e){location.href="#room_gg_verify"}});room_gg_link_check("#room_gg_verify .content a")});c.find(".head a").removeClass("active");$(this).addClass("active")});c.find(".head a.v_use").bind("click",function(f,e){d.hide("fast",function(){$(this).html($ROOM.room_gg["show"]);$(this).show("fast",function(){if(typeof e=="undefined"||e){location.href="#room_gg_verify"}});room_gg_link_check("#room_gg_verify .content a")});c.find(".head a").removeClass("active");$(this).addClass("active")});c.find(".head button").bind("click",function(h,e){var g="";var j={0:"未审核",1:"已审核",2:"关闭"};for(var f in j){if($ROOM.room_gg["status"]==f){g+="<option value='"+f+"' selected>"+j[f]+"</option>"}else{g+="<option value='"+f+"'>"+j[f]+"</option>"}}$.dialog({content:'<div>修改当前详情状态为：<select id="change_room_status">'+g+"</select></div>",icon:"question",okVal:"确定",ok:function(){var i=$("#change_room_status").val();if(i==1&&$ROOM.room_gg["verify"]===false){$.dialog.alert("该房间无新的直播详情，无法提交为已审核状态！");return}loading.show();$.post("/room/my_admin/super_verify_room_gg",{status:i,room_id:$ROOM.room_id},function(k){loading.close();if(k.toLowerCase()=="ok"){$.dialog.alert("操作成功，页面即将刷新.",function(){window.location.href="/"+$ROOM.room_id+"?_r="+Math.random(1)})}else{$.dialog.alert(k)}})},cancelVal:"取消",cancel:function(){}});return false});if($ROOM.room_gg["status"]==1){c.find(".head a.v_use").trigger("click",false);c.find(".head a.v_new").remove()}room_gg_link_check("#room_gg_verify .content a")}function room_gg_link_check(c){if(typeof c=="undefined"){c="#room_gg a"}$(c).off("click");$(c).on("click",function(){if($(this).has("img").length>0){return false}$(this).attr("target","_blank");var e=$(this).attr("href");if(e.substr(0,4)==="http"){e=e.substr(7);if(e.length>0){var f=e.indexOf("/");if(f>0){e=e.substr(0,f)}var d=[window.location.host,"www.douyutv.com","douyutv.com","www.douyu.tv","douyu.tv","www.acfun.tv","acfun.tv","www.acfun.com","www.175kh.com","www.175kh.cn","s4.175kh.com"];return jQuery.inArray(e,d)<0?confirm("访问内容超出本站范围，不能确定是否安全，要继续访问吗？"):true}return false}if(e.indexOf("javascript")===0){return false}})}function super_open_room(){$.dialog.confirm('<p>你确定解除该房间的关闭限制么？</p><p style="margin-top: 5px;color: orangered"><small>时间限制将被清空</small></p>',function(){$.post("/room/my_admin/super_open_room",{room_id:$ROOM.room_id},function(c){if(c.toLowerCase()=="ok"){$.dialog.alert("数据已更新，可以通知主播了")}else{$.dialog.alert("提示："+c)}})})}function htmlspecialchars(e,k,j,d){var g=0,f=0,h=false;if(typeof k==="undefined"||k===null){k=2}e=e.toString();if(d!==false){e=e.replace(/&/g,"&amp;")}e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");var c={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(k===0){h=true}if(typeof k!=="number"){k=[].concat(k);for(f=0;f<k.length;f++){if(c[k[f]]===0){h=true}else{if(c[k[f]]){g=g|c[k[f]]}}}k=g}if(k&c.ENT_HTML_QUOTE_SINGLE){e=e.replace(/'/g,"&#039;")}if(!h){e=e.replace(/"/g,"&quot;")}return e}function change_room_tag(){var room_list=tag_list=all_str="";for(var index in $ROOM.all_tag_list){if($ROOM.room_tag_list!=null&&$.inArray(index,$ROOM.room_tag_list)>-1){room_list+='<a href="javascript:;" data-tid='+index+" data-name="+htmlspecialchars($ROOM.all_tag_list[index]["name"])+"><i>"+$ROOM.all_tag_list[index]["name"]+"</i>(<em>"+$ROOM.all_tag_list[index]["count"]+"</em>)</a>"}else{tag_list+='<a href="javascript:;" data-tid='+index+" data-name="+htmlspecialchars($ROOM.all_tag_list[index]["name"])+"><i>"+$ROOM.all_tag_list[index]["name"]+"</i>(<em>"+$ROOM.all_tag_list[index]["count"]+"</em>)</a>"}}all_str+='<div class="aui_content" style="padding: 15px; width:510px;"><div class="add_tag clearfix"><div class="add_tli js_add_accept clearfix"><p class="type fl">房间标签：</p><div class="js_remove_bt add_label fl">'+room_list+'</div></div><div class="add_tli js_add_attack clearfix"><p class="type fl">添加标签：</p><div class="js_add_bt add_label fl">'+tag_list+"</div></div></div></div>";$.dialog({title:"直播标签设置",content:all_str,okVal:"确定修改分类",init:function(){oTab("#hotgame","click");AddTips()},ok:function(){var type=0;var tag_id=[];var confirm_str="";if($(".js_remove_bt").find("a.cur").length>0){type=1;confirm_str+="确定取消当前直播间使用标签：";$.each($(".js_remove_bt").find("a.cur"),function(i,obj){tag_id.push($(obj).data("tid"));if(i+1!=$(".js_remove_bt").find("a.cur").length){confirm_str+=$(obj).data("name")+"、"}else{confirm_str+=$(obj).data("name")}})}if($(".js_add_bt").find("a.cur").length>0){type=2;confirm_str+="确定给当前直播间增加标签：";$.each($(".js_add_bt").find("a.cur"),function(i,obj){tag_id.push($(obj).data("tid"));if(i+1!=$(".js_add_bt").find("a.cur").length){confirm_str+=$(obj).data("name")+"、"}else{confirm_str+=$(obj).data("name")}})}confirm_str+=" ? ";if(type==0){$.dialog.alert("请选择标签进行操作");return false}$.dialog.confirm(confirm_str,function(){$.post("/room/my_admin/change_room_tags",{room_id:$ROOM.room_id,type:type,"tag_id[]":tag_id},function(data){data=eval("("+data+")");if(data.error>0){$.dialog.alert("更新失败："+data.msg)}else{$.dialog.alert("操作成功，页面即将刷新.",function(){window.location.href="/"+$ROOM.room_id+"?_r="+Math.random(1)})}})})},cancelVal:"取消",cancel:function(){},lock:true});return false}function change_room_cate(){var option_list="";for(var index in $ROOM.game_cate_list){if(index==$ROOM.cate_id){option_list+='<option selected value="'+index+'">'+$ROOM.game_cate_list[index]+"</option>"}else{option_list+='<option value="'+index+'">'+$ROOM.game_cate_list[index]+"</option>"}}$.dialog({title:"直播分类修改",content:'<p>修改分类为：<select id="change_room_cate_select">'+option_list+'</select></p><br><p>修改时间限制<input type="text"  name="cate_time" id="cate_time" value="6" max="10"/>小时</p>',okVal:"确定修改分类",ok:function(){var new_cate=$("#change_room_cate_select").val();var reg=/^([0-9]\d*)$/;var cate_time=$("#cate_time").val();if(!reg.test(cate_time)){alert("限制时间必须为不小于0的整数");return false}$.dialog.confirm("确定将分类由 <strong>"+$ROOM.cate_name+"</strong> 修改为 <strong>"+$ROOM.game_cate_list[new_cate]+"</strong> ?",function(){$.post("/room/my_admin/change_game_cate",{cate_time:cate_time,room_id:$ROOM.room_id,tag_id:new_cate},function(data){data=eval("("+data+")");if(data.error>0){$.dialog.alert("更新失败："+data.msg)}else{$.dialog.alert("操作成功，页面即将刷新.",function(){window.location.href="/"+$ROOM.room_id+"?_r="+Math.random(1)})}})})},cancelVal:"取消",cancel:function(){},lock:true});return false}var load_live_info;$(document).ready(function(){var e="11.1.0";var f={};f.Servers=room_args.server_config;f.RoomId=$ROOM.room_id;f.cate_id=$ROOM.cate_id;f.cdn=get_url_param("cdn");f.OwnerId=$ROOM.owner_uid;f.Status=$ROOM.show_status===1?true:false;f.closeFMS=$ROOM.show_status!==1||room_args.live_url?true:false;f.DomainName=window.location.host;f.asset_url=$SYS.res_url;f.roompass=$ROOM.room_pwd;f.checkowne=$SYS.uid==$ROOM.owner_uid?1:0;f.usergroupid=$SYS.groupid;f.uid=$SYS.uid?$SYS.uid:0;f.room_link="";var i={};i.quality="high";i.bgcolor="#ffffff";i.allowscriptaccess="always";i.allowfullscreen="true";i.wmode="Opaque";i.allowFullScreenInteractive="true";var j={};j.id="WebRoom";j.name="WebRoom";j.align="middle";j.allowscriptaccess="always";j.allowfullscreen="true";j.allowFullScreenInteractive="true";swfobject.embedSWF(room_args.swf_url,"flashContent",room_args.live_url?"0":"100%",room_args.live_url?"0":"100%",e,"",f,i,j);swfobject.createCSS("#flashContent","display:block;text-align:left;");$("#follow_sign").remove();if(!$("body").data("view")&&($ROOM.show_status==1)&&$SYS.uid==$ROOM.owner_uid){load_live_info=$.dialog.tips_black("正在加载直播信息，请稍后……",15)}$("#js_room_nav li").click(function(){$(this).addClass("hover").siblings().removeClass("hover");var c=$("#js_room_nav li").index(this);if(c==0){$("#js_room_box>div").eq(0).show().siblings().hide();set_ad_width()}$("#js_room_box>div").eq(c).show().siblings().hide()});if(typeof $ROOM.room_gg!="undefined"&&typeof $ROOM.room_gg["status"]!="undefined"&&($ROOM.room_gg["status"]==1||$ROOM.room_gg["status"]==0)){$("#room_gg").html($ROOM.room_gg["show"])}if($SYS.groupid==5){room_gg_verify()}else{room_gg_link_check()}var n=$("#room_gg").length?$("#room_gg").html().replace(/[\s]*/g,""):"";if(n==""){$("#live_detal").remove();$(".rn1").remove()}var m=$(".rn_warp").text()?$(".rn_warp").text().replace(/[\s]*/g,""):"";if(m==""){$("#great_tv").remove();$(".rn2").remove()}if(room_args.def_disp_gg==1){$("#live_detal").addClass("hover");$("#live_detal").trigger("click")}else{$("#js_room_nav ul").children().eq(0).addClass("hover");$("#js_room_nav ul").children().eq(0).trigger("click")}if($("body").attr("data-view")!=="1"){var p=$("#hot_pop").length;if(p==0){$("#live_detal").trigger("click")}if(n==""&&p==0){$("#js_room_nav").remove();$("#js_room_box").remove()}}if($ROOM.show_status==1&&$SYS.uid==$ROOM.owner_uid){$("#livecode_but").show()}else{$("#livecode_but").remove()}if(typeof(task_obj)!="undefined"){task_obj.init()}if($("body").data("view")){if($("#cq_fans").length>0&&!$("#cq_fans").is(":hidden")){$(".chat_cls").css("top","205px");$(".gift_rolling").css("top","196px")}}else{if($("#cq_fans").length>0&&!$("#cq_fans").is(":hidden")){$(".chat_cls").css("top","120px");$(".gift_rolling").css("top","111px")}}if(!$("body").data("cq")){$(".sgive_yw").css("right","0")}if($("#left_col").length){$("#main_col").height($(window).height())}set_window_width();set_live_height();$(window).resize(function(){set_window_width();set_live_height();if($("#small_nav").is(":visible")){$("#guide_login,#back").hide()}});if(typeof $ROOM.owner_uid=="undefined"||typeof $SYS.uid=="undefined"||$ROOM.owner_uid!=$SYS.uid){$(".room_mes").mouseover(function(){$("#feedback_report_button").show()}).mouseout(function(){$("#feedback_report_button").hide()});$("#feedback_report_button").click(function(){if($SYS.uid<1){user_dialog.open_login();return false}return true})}$("#js_page_url").val($ROOM.room_url);if($SYS.uid&&$SYS.uid==$ROOM.owner_uid){$(".js_login_myroom").show();$(".js_room_user").hide()}$("#chart_content").on("keyup",function(){if($(this).val().length>=maxcontent){$(this).val($(this).val().substr(0,maxcontent))}});$("#select_box").delegate("#roomadmin","mouseover",function(c){$("#roomadminul").show()});$("#select_box").bind("mouseleave",function(c){$("#roomadminul").hide()});$("input").focus(function(){in_input=true});$("textarea").focus(function(){in_input=true});$("input").blur(function(){in_input=false});$("textarea").blur(function(){in_input=false});$("#right_close").click(function(){var c=$("#right_col");var d=$("#main_col");if(c.is(":visible")){c.hide();d.css("margin-right",0);$("#right_close").addClass("right_open");setCookie("right_menu",1,2592000)}else{d.css("margin-right","325px");c.show();$("#right_close").removeClass("right_open");setCookie("right_menu",0,2592000)}set_live_height();return false});$("#js_switch_live").click(function(){if($(this).hasClass("switch_on")){$.dialog({content:'您确定要关闭直播吗？<br />(<span style="color:red;font-size: 10px;">如果关闭直播，务必关闭推流软件</span>)',icon:"question",okVal:"确定",ok:function(){window.location.href="/room/my/close_show"},cancelVal:"取消",cancel:function(){}})}else{$.getJSON("/member/cp/get_phone_status",function(c){if(c.result==-1){$.dialog.alert("您还没有验证手机号，不能开启直播");return}else{if(c.result==2){if(c.error.ident_status==1){$("#js_ident_name").html("正在审核中，请审核通过后再来开播……");$("#js_ident_button").html("确定")}$("#js_phone_div").show();return}else{js_live_room()}}})}return false});$("#js_remind_start").click(function(){$.getJSON("/room/my/remind",function(c){if(c.error==0){$.dialog.alert("提醒成功");$("#js_remind_start").attr("class","r_send r_sendon");$("#js_remind_start").unbind("click");return}else{$.dialog.alert(c.msg);return}})});$("#select_box").delegate("#js_no_home","click",function(c){if($("#js_no_home").data("doing")){$.dialog.alert("设置已提交，请等待1~2分钟服务器更新");return false}if(room_args.no_home){$.dialog.confirm("当前房间已被设置不推荐到首页，有效期至"+room_args.no_home_time+"。<br>请问是否需要取消限制？",function(){$.get("/room/my_admin/no_home_cancel/"+$ROOM.room_id,function(d){$.dialog.alert("设置已提交，请等待1~2分钟服务器更新，在此期间请勿对本房间反复提交");$("#js_no_home").data("doing",1)})})}else{$.dialog.prompt("不推荐到正在直播多少小时？",function(d){d=parseInt(d,10);if(d<1){$.dialog.alert("限制时间最少1小时");return false}$.get("/room/my_admin/no_home_set/"+$ROOM.room_id,{hour:d},function(q){if(q=="error"){$.dialog.alert("设置失败，请确认房间当前状态")}else{$.dialog.alert("设置已提交，请等待1~2分钟服务器更新，在此期间请勿对本房间反复提交");$("#js_no_home").data("doing",1)}})},"24")}return false});$("#js_share a.share-btn, #js_share_more_ico a").click(function(){var c=$(this).data("to");if(c){if(c=="tsina"){var d="&appkey=979098171&ralateuid=3982726153"}else{var d=""}$(this).attr("href","http://www.jiathis.com/send/?webid="+c+"&url="+encodeURIComponent($ROOM.room_url)+"&title=&summary="+encodeURIComponent("我正在 "+$ROOM.room_name+" 的房间观看直播 / 主播"+$ROOM.owner_name+"，欢迎大家前来围观 / 来自#斗鱼#游戏直播！")+"&uid=1896137&data_track_clickback=true&pic="+encodeURIComponent($ROOM.room_pic)+d).attr("target","_blank")}else{return false}});var g=null;$("#js_share .js_share_more").click(function(){if($("#js_share_more").is(":hidden")){if(g){clearTimeout(g)}$(".share_more").removeClass("share_more_single");if($(".js_live_height").width()-$(".js_live_height .h_action").width()+$("#js_share").width()<600){$(".share_more").addClass("share_more_single")}$("#js_share_more").show();if($("body").data("copy")==undefined){$("#js_share_more a.s_copy").each(function(){$(this).zclip({path:room_args.res_path+"images/ZeroClipboard.swf",copy:$(this).prev().val(),afterCopy:function(){$.dialog.tips_black("已复制到您的剪切板",1.5)}})});$("body").data("copy",1)}$(".js_share_more").removeClass("more01");$(".js_share_more").addClass("more")}else{$("#js_share_more").hide();$(".js_share_more").removeClass("more");$(".js_share_more").addClass("more");$(".js_share_more").addClass("more01")}return false});window.onUnload=function(){thisMovie("WebRoom").windowCloseHandler()};if($ROOM.show_status==0&&$SYS.uid==$ROOM.owner_uid){showintervalobj=setInterval("get_show_status("+$ROOM.show_id+")",30000)}if(($SYS.uid==$ROOM.owner_uid)||$SYS.groupid==5){document.getElementById("chart_content").maxLength=200;maxcontent=200;intervaltime=send_interval_time=0}if($SYS.uid==$ROOM.owner_uid){$("#js_cq_li,#cqbut").remove()}$("#switch").click(function(){htmlswitch("face_list");$("#js_colours .colours_box").hide();return false});$("#user_black").on("click",function(){if($(this).attr("rel")==0){black_obj.black_myblacklis_add()}else{if($(this).attr("rel")==1){black_obj.black_myblacklis_del()}}return false});if($SYS.groupid!=5){$("#user_onekeyblack").remove()}else{$("#user_onekeyblack").on("click",function(){black_obj.black_onekeyblack()});$("#onekeyblackshow input[name='oreason'], #onekeyblackshow select[name='ban_reason']").focus(function(c){$(c.target).prev(":radio").prop("checked",true)})}$("#user_report").on("click",function(){black_obj.chat_report()});$("#giftnum").bind("click",function(c){$("#gnumlist").show();return false});$(".gnumbut").bind("click",function(c){$("#giftnum").val($(this).html());$("#gnumlist").hide();return false});$("#gnumdiv").bind("mouseleave",function(c){$("#gnumlist").hide()});$("#chat_line_list").delegate("a.js_nick","click",function(r){if($("body").data("page")=="qqapp"){return false}clickuid=$(this).attr("rel");var q=!$SYS.uid?touristuid:$SYS.uid;if(!$SYS.uid){return false}if(q!=clickuid){var c=$(this).position();var d=typeof(is_topic_page)=="undefined"?0:15;popUp(c.left,c.top+$(this).outerHeight(true)+d);menu_show(this)}return false});$(".user_wrap").on("mouseleave",function(){$("#itemopen").hide()});$("#adminsetup").on("click",function(){adminreg();$("#itemopen").hide();return false});$("#scrollcheck").prop("checked",false);if(get_cookie("scrollcheck")){$("#scrollcheck").prop("checked",true)}$("#blackgift").on("click",function(){var c=add_ttlist("chat_line_list");if($("#blackgift").is(":checked")){c.html('<span style="color:#ff0000;">现在将不会看到其他玩家礼物赠送记录</span>')}else{c.html('<span style="color:#ff0000;">现在将能看到其他玩家礼物赠送记录</span>')}$("#opmenu").hide();scrdown("chat_lines")});$("#scrollcheck").on("click",function(){if($("#cscroll").data("stat")){setCookie("scrollcheck",1,864000)}else{delCookie("scrollcheck")}$("#opmenu").hide()});$("#chat_lines").hover(function(){$(this).data("hover",1)},function(){$(this).data("hover",0)});$("#chat_lines, #commonscrn").bind("mouseover",function(c){$("#commonscrn").show()});$("#chat_lines").bind("mouseleave",function(c){$("#commonscrn").hide()});$("#commonscroll,#privatescroll").on("click",function(){var c="";if($(this).attr("rel")=="scroll-off"){c="scroll-on";$(this).removeClass("roll_icon");$(this).addClass("roll_icon_open")}else{c="scroll-off";$(this).removeClass("roll_icon_open");$(this).addClass("roll_icon")}$(this).attr("rel",c);return false});$(".chat_cont").bind("mouseover",function(c){$("#chat_menu").show()});$(".chat_cont").bind("mouseleave",function(c){$("#chat_menu").hide()});$("#cscroll").click(function(){var c=$(this).data("stat");$(this).removeClass("scr clo");if(!c){$(this).html("开始滚屏");$(this).addClass("scr");$(this).data("stat",1)}else{$(this).html("关闭滚屏");$(this).addClass("clo");$(this).data("stat",0)}return false});$("#select_box").delegate("#js_use_p2p","click",function(d){if($SYS.groupid!=5){return false}var c=$(this).data("status");confirm_msg("确定要"+(c==0?"关闭":"开启")+"P2P模式吗？",function(){loading.show();$.post("/room/my_admin/super_p2p",{room_id:$ROOM.room_id,status:c},function(q){loading.close();alert_msg("更改已提交，请等待1~2分钟服务器更新，在此期间请勿对本房间反复提交")})})});$("#select_box").delegate("#js_multibit","click",function(d){if($SYS.groupid!=5){return false}var c=$(this).data("status");confirm_msg("确定要"+(c==0?"关闭":"开启")+"强制多码率模式吗？",function(){loading.show();$.post("/room/my_admin/super_multibit",{room_id:$ROOM.room_id,status:c},function(q){loading.close();alert_msg("更改已提交，请等待1~2分钟服务器更新，在此期间请勿对本房间反复提交")})})});$("#chart_content").bind("keypress",function(c){if(c.which==13){sendmsg();return false}});$("#chart_content").bind("keydown click focus keyup",function(c){getTxt1CursorPosition("chart_content",1)});$("#sendmsg_but").click(function(){sendmsg();return false});$("#face_list em").on("click",function(){if(document.getElementById("chart_content").value=="这里输入聊天内容"){document.getElementById("chart_content").value=""}var d=$(this).attr("ftype");var q="[emot:"+$(this).attr("rel")+"]";if(d=="chat"){var c=$("#chart_content").val().length;var r=parseInt($("#chart_content").attr("maxlength"));if(c<r){getValue("chart_content",q,1);$("#chart_content").blur();$("#chart_content").focus()}$("#face_list").hide()}return false});$(".js_tipsy").bind("mousemove mouseleave",function(q){if(q.type=="mouseleave"){$("#tipsy").hide()}else{var c=$(this).offset();$("#tipsy").css("top",c.top+$(this).outerHeight(true)+6);var d=($("#tipsy").outerWidth(true)-$(this).outerWidth(true))/2;$("#tipsy").css("left",c.left-d);$("#tiptit").html($(this).data("title"));$("#tipsy").show()}});$("#ng_qd").click(function(){$("#back,#fxshow,#qdshow").hide();return false});$(".delshow,.is_ng_qd").click(function(){$("#back,.js_zy").hide();return false});$("#lyzmclose").click(function(){$("#lyzmbut").removeClass("bnn2");$("#lyzmbut").prop("disabled",false);$("#lyzm,#back").hide();$("#taskid").val("")});$("#task_captcha").load(function(){$("#lyzm_codelist b").not(".delete").css("backgroundPositionX","-500px").css("backgroundPositionY","-500px");$("#lyzm_codelist b").not(".delete").css("background-position","-500px -500px");$("#lyzm_codelist b").attr("c","0");$("#task_ca").val("");var c="url("+$("#task_captcha").attr("src")+")";$("#lyzm_piclist b, #lyzm_chkimg,#lyzm_codelist b").not(".delete").css("background-image",c);loading.close()});$("#lyzm_piclist").on("click","a",function(){var c=$(this).find("b");var r=c.attr("num");var q=(document.all&&!window.opera)?[c.css("backgroundPositionX"),c.css("backgroundPositionY")]:c.css("background-position").split(" ");q[0]=parseInt(q[0].replace("px"))-3;q[1]=parseInt(q[1].replace("px"))-3;if(r!=null){var d=$("#task_ca").val()+r;$("#task_ca").val(d);$("#lyzm_codelist b").not(".delete").each(function(s){if($(this).attr("c")!="1"){$(this).css("background-position",q[0]+"px "+q[1]+"px");$(this).css("backgroundPositionX",q[0]+"px");$(this).css("backgroundPositionY",q[1]+"px");$(this).attr("c","1");if(s==3){if(!$("#lyzm").data("code_type")){task_obj.reward_send_rpc()}else{box_obj.send_receive()}}return false}})}});$("#lyzm_codelist b.delete").click(function(){$("#lyzm_codelist b").not(".delete").css("backgroundPositionX","-500px").css("backgroundPositionY","-500px");$("#lyzm_codelist b").not(".delete").css("background-position","-500px -500px");$("#lyzm_codelist b").attr("c","0");$("#task_ca").val("")});$("#jumpic .cqgm").click(function(){if(!$SYS.uid){open_login();return false}var r="";var d=$(this).data("price");var q=$(this).data("lv");switch(q){case 1:r="初级酬勤";break;case 2:r="中级酬勤";break;case 3:r="高级酬勤";break;case 4:r="超级酬勤";break}var c='<span style="font-size:20px; display:inline-block; padding:8px 0;">'+r+"</span><br/>"+$("#cqbut").data("mindate")+"到"+$("#cqbut").data("maxdate")+"<br/>";c+='<span style="font-size:12px; color: #b1b1b1;">*每月21号（含21号）后只能赠送次月酬勤</span>';$("#cqqdtit").html(c);$("#cqqd").show();$("#cqqdbut").data("lv",q);return false});$("#cqqdbut").click(function(){var c=$(this).data("lv");if(!c){$.dialog.tips_black("请选择赠送类型",2)}$("#cqqd").hide();cq_obj.buy(c);return false});$("#cqbut").click(function(){if(!$SYS.uid){open_login();return false}$("#cqchannel").hide();if($("#cqdiv").is(":hidden")){$("#cqpic").attr("src",get_avatar($ROOM.owner_uid,"middle"));$("#cqdiv").show();$("#showtime").html("");$(".jsroomcq").html('<img src="'+$SYS.res_url+'douyu/images/loading.gif"  />');$(".jssc").eq(0).html(0);$(".jssc").eq(1).html(30);$(".jssc").eq(2).html(45);$(".jssc").eq(3).html(60);$(".progressbar .sc").each(function(){$(this).css("margin-left","-"+Math.floor($(this).width()/2)+"px")});$("#cqbar").width(0);$.ajax({type:"POST",url:"/member/cq/get_cq_show",data:{owner_uid:$ROOM.owner_uid,room_id:$ROOM.room_id},dataType:"json",success:function(c){$("#roomcq1").html(c.user_room_cq.L1);$("#roomcq2").html(c.user_room_cq.L2);$("#roomcq3").html(c.user_room_cq.L3);$("#usergold").html(c.user_gold);var d=c.show_time;$("#showtime").html("已直播"+c.show_time+"小时");$("#cqbar").width(0);$(".hour_tit").removeClass("h_get");$(".hour_tit .h1").html("直播未达到此酬勤奖励要求");if(d>=120){$(".hour_tit").eq(2).addClass("h_get").find(".h1").html("直播已达到此酬勤奖励要求")}if(d>=80){$(".hour_tit").eq(1).addClass("h_get").find(".h1").html("直播已达到此酬勤奖励要求")}if(d>=60){$(".hour_tit").eq(0).addClass("h_get").find(".h1").html("直播已达到此酬勤奖励要求")}if(d>=120){$("#cqbar").animate({width:"437px"},1000);$("#lastcq").html("主播已在超神路上.....");$(".jssc").eq(0).html(80);$(".jssc").eq(1).html(100);$(".jssc").eq(2).html(110);$(".jssc").eq(3).html(120)}else{if(d>80){$("#cqbar").animate({width:parseInt(437*(d-80)/40)+"px"},1000);$("#lastcq").html("距离高级酬勤还有"+(120-d)+"小时");$(".jssc").eq(0).html(80);$(".jssc").eq(1).html(100);$(".jssc").eq(2).html(110);$(".jssc").eq(3).html(120)}else{if(d>60){$("#cqbar").animate({width:parseInt(437*(d-60)/20)+"px"},1000);$("#lastcq").html("距离中级酬勤还有"+(80-d)+"小时");$(".jssc").eq(0).html(60);$(".jssc").eq(1).html(70);$(".jssc").eq(2).html(75);$(".jssc").eq(3).html(80)}else{if(d>0){$("#cqbar").animate({width:parseInt(437*d/60)+"px"},1000);$("#lastcq").html("距离初级酬勤还有"+(60-d)+"小时");$(".jssc").eq(0).html(0);$(".jssc").eq(1).html(30);$(".jssc").eq(2).html(45);$(".jssc").eq(3).html(60)}}}}$(".progressbar .sc").each(function(){$(this).css("margin-left","-"+Math.floor($(this).width()/2)+"px")})}})}else{$("#cqdiv").hide()}return false});var h=$("#js_mlist .m_nav ul li");h.click(function(){$(this).addClass("activ").siblings().removeClass("activ");var c=h.index(this);$("#js_mlist .m_cnt .m_con").eq(c).show().siblings().hide()});$(".cq_mc").mouseenter(function(){if($("#cq_rank").find("li").length>3){$("#js_mlist").animate({height:"300px"},200)}});$(".cq_mc").mouseleave(function(){$("#js_mlist").animate({height:"110px"},200)});$(".get_fc").hide();if(!get_cookie("boxtit")){if($SYS.uid){setTimeout("$('#get_fc').show()",20000);setCookie("boxtit",1,28800)}else{$("#get_fc2").show();setCookie("boxtit",1,28800)}}$("#box_show").click(function(){if(!$SYS.uid){open_login();return false}if(parseInt($(this).data("leve"))>5){box_obj.tit_show("今天的任务已完成了");return false}if(!$(this).data("stat")){box_obj.tit_show("别心急，还没到领取时间");return false}$("#lyzm").data("code_type",1);$("#lyzm,#back").show();setTimeout('$("#task_ca").focus()',100);$("#lyzmbut").removeClass("bnn2");$("#lyzmbut").prop("disabled",false);user_form.update_vcode("task_captcha");return false});$("#give_yw").click(function(){if($(".sgive_yw").is(":hidden")){$(this).addClass("cur");$(".sgive_yw").show()}else{$(this).removeClass("cur");$(".sgive_yw").hide()}});var l=$(".sgive_yw .su_nav ul li");var k=$(".sgive_yw .su_cnt .su_con");l.hover(function(){var c=l.index(this);k.eq(c).show().animate({opacity:100,"margin-top":0},200)},function(){k.hide().animate({opacity:0,"margin-top":"3px"},200)});$("#gift_list li").click(function(){var c=$(this).children("a").data("num");gift_obj.send_very_gift(c);return false});$("#select_box").delegate("#get_room_data","click",function(c){loading.show("正在载入");$.ajax({type:"GET",url:"/room/my_admin/get_room_data",data:{room_id:$ROOM.room_id},dataType:"json",success:function(d){loading.close();if(d.ret>0){$.dialog.tips_black(d.msg,2)}else{$.dialog.alert(d.a_bw)}}});return false});(function(d){d("#room_qrcode_box .content").mouseenter(function(){d(this).find("div.app_box").show();d(this).addClass("qrcode_box_show").find(".box").slideDown("fast")});d("#room_qrcode_box .content ").mouseleave(function(){d(this).find("div.app_box,div.box").delay(500).hide();d(this).removeClass("qrcode_box_show")});if(typeof d.fn.qrcode!=="undefined"){var r="canvas";if(navigator.appName=="Microsoft Internet Explorer"&&parseInt(navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/)[1])<9){r="table"}var c=$ROOM.room_url;var q=c.indexOf("?");if(q>0){c=c.substring(0,q)}d("#qrcodeimg").qrcode({render:r,width:100,height:100,text:c})}d("#r_share").hover(function(){if(d("#js_share_more1").is(":hidden")){d(".share_more").removeClass("share_more_single");if(d(".js_live_height").width()-d(".js_live_height .h_action").width()+d("#js_share").width()<600){d(".share_more").addClass("share_more_single")}d("#js_share_more1").show();d("#js_share_more1 a.s_copy").each(function(){if(d(this).parent("div").is(":hidden")){d(this).parent("div").show();d(this).parent("div").addClass("haschange")}d(this).zclip({path:room_args.res_path+"images/ZeroClipboard.swf",copy:d(this).prev().val(),afterCopy:function(){d.dialog.tips_black("已复制到您的剪切板",1.5)}});if(d(this).parent("div").hasClass("haschange")){d(this).parent("div").hide();d(this).parent("div").removeClass("haschange")}});d(".js_share_more").removeClass("more01");d(".js_share_more").addClass("more")}return false},function(){d("#js_share_more1").hide();d(".zclip").remove();d(".js_share_more").removeClass("more");d(".js_share_more").addClass("more");d(".js_share_more").addClass("more01")})})(jQuery);(function(d){function q(){d("#js_tdc_frame .task_close").click(function(){d("#js_tdc_frame").hide()});var r=5;d("#js_tdc_frame div.task_box table tbody").on("click","a",function(){if(d(this).hasClass("exp_btn")){var t=d(this).data("expand");if(t==null||t==0){var s=d(this).parents("div.task_box").find("div.task_matter");s.removeClass("task_matter").addClass("task_tit");s.find("a").data("expand",0).html("[展开]");d(this).parent("div").removeClass("task_tit").addClass("task_matter");d(this).html("[收起]");d(this).data("expand",1);d(this).parent().parent().css({"z-index":++r})}else{d(this).parent("div").removeClass("task_matter").addClass("task_tit");d(this).data("expand",0).html("[展开]")}}})}if($SYS.uid==$ROOM.owner_uid){var c='<div id="qrcodeprom_btn" style="*margin-left:5px" class="livecodebut fr qrcodeprom_btn">获取推广二维码</div>';d("#select_box").before(c);d("#qrcodeprom_btn").click(function(){if(d("#js_tdc_frame").length<=0){d.get("/Qrcodeprom/get_list",function(r){d("body").append(r);q()})}else{d("#js_tdc_frame").show()}})}})(jQuery)});function defaut_live_room(){var c=$("#js_switch_live");if(c.data("doing")==1){return false}c.data("doing",1);loading.lock=true;loading.show("正在提交，请勿刷新页面……");$.getJSON("/room/my/first_show",function(e){loading.close();c.data("doing",0);if(e.error==0){c.addClass("switch_on");var d="succeed"}else{if(e.error==3){$.dialog.alert("异常关闭<br />原因：<b>"+e.msg.reason+"</b><br />剩余限时：<span style='color: red'>"+e.msg.open_time+"</span>");return}else{var d="warning"}}$.dialog({icon:d,content:e.msg,lock:true,okVal:"确定",ok:function(){if(d){window.location.href="/"+$ROOM.room_id+"?_r="+Math.random(1)}return true}})})}function qq_push(d,c){if(c){$.dialog.confirm("确定将该房间推送到QQ APP上么?",function(){loading.show();$.ajax({type:"POST",url:"/room/my_admin/qq_push",data:{id:d,status:"PUSH"},dataType:"json",success:function(e){loading.close();if(e.error==0){$.dialog.tips_black("已成功推送到QQ APP上，请等待更新！")}else{$.dialog.alert("推送错误:<span style='color: red'>"+e.msg+"</span>")}}})})}else{$.dialog.confirm("确定<span style='color: red'>取消</span>QQ APP的推送么?",function(){loading.show();$.ajax({type:"POST",url:"/room/my_admin/qq_push",data:{id:d,status:"CANCEL"},dataType:"json",success:function(e){loading.close();if(e.error==0){$.dialog.tips_black("取消推送QQ APP成功，请等待更新！")}else{$.dialog.alert("操作失败:<span style='color: red'>"+e.msg+"</span>")}}})})}return false};